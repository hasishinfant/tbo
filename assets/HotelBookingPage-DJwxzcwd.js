const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trip-planner-features-Cy4avEMv.js","assets/query-Btr53e-p.js","assets/router-CHgP5jf5.js","assets/destination-features-rioVTb2Z.js","assets/axios-B1ATcuf8.js","assets/destination-features-CfXsvwvv.css","assets/trip-planner-features-ysyyviqT.css"])))=>i.map(i=>d[i]);
import{j as e}from"./query-Btr53e-p.js";import{r as t,u as s}from"./router-CHgP5jf5.js";import{a as r}from"./axios-B1ATcuf8.js";import{_ as a}from"./index-6W7d765Y.js";import"./destination-features-rioVTb2Z.js";const i={baseUrl:"http://api.tbotechnology.in/TBOHolidays_HotelAPI",username:"",password:"",timeout:1e4,retryAttempts:3,retryDelay:1e3};class n{client;config;constructor(e={}){this.config={...i,...e},this.client=this.createAxiosInstance(),this.setupInterceptors()}createAxiosInstance(){return r.create({baseURL:this.config.baseUrl,timeout:this.config.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"},auth:{username:this.config.username,password:this.config.password}})}setupInterceptors(){this.client.interceptors.request.use(e=>e,e=>Promise.reject(e)),this.client.interceptors.response.use(e=>{if(0===e.data?.Status||2===e.data?.Status){const t=e.data.Message||"API request failed";throw this.createApiError("API_ERROR",t)}return e},async e=>this.handleResponseError(e))}async handleResponseError(e){const t=e.config;if(!t)throw this.createApiError("NETWORK_ERROR","Network request failed");t._retryCount=t._retryCount||0;if(this.shouldRetryRequest(e,t._retryCount)&&t._retryCount<this.config.retryAttempts){t._retryCount+=1;const e=this.config.retryDelay*Math.pow(2,t._retryCount-1);return await this.sleep(e),this.client.request(t)}throw this.createApiError(e.code||"UNKNOWN_ERROR",e.message||"An unknown error occurred",{originalError:e})}shouldRetryRequest(e,t){if(t>=this.config.retryAttempts)return!1;if(!e.response)return!0;return[408,429,500,502,503,504].includes(e.response.status)}createApiError(e,t,s){return{error:{code:e,message:t,details:s},recoverable:this.isRecoverableError(e)}}isRecoverableError(e){return["NETWORK_ERROR","TIMEOUT","ECONNABORTED","ECONNRESET","ETIMEDOUT","408","429","500","502","503","504"].includes(e)}sleep(e){return new Promise(t=>setTimeout(t,e))}async searchHotels(e){return(await this.client.post("/search",e)).data}async getHotelDetails(e){return(await this.client.post("/Hoteldetails",e)).data}async preBook(e){return(await this.client.post("/PreBook",e)).data}async createBooking(e){return(await this.client.post("/Book",e)).data}async getBookingDetails(e){return(await this.client.post("/BookingDetail",e)).data}async getBookingsByDateRange(e){return(await this.client.post("/BookingDetailsBasedOnDate",e)).data}async cancelBooking(e){return(await this.client.post("/Cancel",e)).data}async getCountryList(){return(await this.client.get("/CountryList")).data}async getCityList(e){return(await this.client.post("/CityList",e)).data}async getHotelCodeList(e){return(await this.client.post("/TBOHotelCodeList",e)).data}async healthCheck(){try{return await this.getCountryList(),!0}catch(e){return!1}}}let o=null;function l(e){return o||(o=new n(e)),o}l();class c{apiClient=l();currentSession=null;async search(e){this.validateSearchCriteria(e);try{const t=this.transformToApiRequest(e),s=await this.apiClient.searchHotels(t);if(1===s.Status&&s.Hotels){const t=this.transformHotelsToInternalModel(s.Hotels),r={hotels:t,searchCriteria:e,totalResults:t.length,isMockData:!1};return this.createSession(e,r),r}throw new Error(s.Message||"Hotel search failed")}catch(t){return this.handleSearchError(t,e)}}filterResults(e,t){return t&&0!==Object.keys(t).length?e.filter(e=>{if(void 0!==t.Refundable&&e.refundable!==t.Refundable)return!1;if(void 0!==t.StarRating&&e.starRating!==t.StarRating)return!1;if(void 0!==t.MealType){if(!this.matchMealType(e.mealType,t.MealType))return!1}if(t.HotelName&&""!==t.HotelName.trim()){const s=e.hotelName.toLowerCase(),r=t.HotelName.toLowerCase();if(!s.includes(r))return!1}return!(void 0!==t.NoOfRooms&&e.availableRooms<t.NoOfRooms)}):e}getCurrentSearchSession(){return this.currentSession}clearSession(){this.currentSession=null}validateSearchCriteria(e){if(!e.checkIn||!e.checkOut)throw new Error("Check-in and check-out dates are required");const t=new Date(e.checkIn),s=new Date(e.checkOut),r=new Date;if(r.setHours(0,0,0,0),t<r)throw new Error("Check-in date cannot be in the past");if(s<=t)throw new Error("Check-out date must be after check-in date");if(!e.hotelCodes&&!e.cityCode)throw new Error("Either hotel codes or city code is required");if(!e.guestNationality)throw new Error("Guest nationality is required");if(!e.paxRooms||0===e.paxRooms.length)throw new Error("At least one room is required");if(e.paxRooms.length>9)throw new Error("Maximum 9 rooms can be searched at once");for(let a=0;a<e.paxRooms.length;a++){const t=e.paxRooms[a],s=a+1;if(t.adults<1)throw new Error(`Room ${s}: Each room must have at least one adult`);if(t.adults>9)throw new Error(`Room ${s}: Maximum 9 adults per room`);if(t.children<0)throw new Error(`Room ${s}: Children count cannot be negative`);if(t.children>9)throw new Error(`Room ${s}: Maximum 9 children per room`);if(t.children>0&&t.childrenAges.length!==t.children)throw new Error(`Room ${s}: Children ages must be provided for all ${t.children} children (received ${t.childrenAges.length} ages)`);if(t.children>0)for(let e=0;e<t.childrenAges.length;e++){const r=t.childrenAges[e];if(!Number.isInteger(r))throw new Error(`Room ${s}, Child ${e+1}: Age must be a whole number`);if(r<0)throw new Error(`Room ${s}, Child ${e+1}: Age cannot be negative`);if(r>17)throw new Error(`Room ${s}, Child ${e+1}: Age must be 17 or under (use adult for 18+)`)}const r=t.adults+t.children;if(r>9)throw new Error(`Room ${s}: Maximum 9 guests per room (${t.adults} adults + ${t.children} children = ${r})`)}}transformToApiRequest(e){return{CheckIn:this.formatDate(e.checkIn),CheckOut:this.formatDate(e.checkOut),HotelCodes:e.hotelCodes,CityCode:e.cityCode,GuestNationality:e.guestNationality,PaxRooms:e.paxRooms.map(e=>({Adults:e.adults,Children:e.children,ChildrenAges:e.childrenAges})),ResponseTime:e.responseTime,IsDetailedResponse:e.isDetailedResponse,Filters:e.filters}}transformHotelsToInternalModel(e){return e.map(e=>({bookingCode:e.BookingCode,hotelCode:e.HotelCode,hotelName:e.HotelName,starRating:e.StarRating,address:e.HotelAddress,contactNumber:e.HotelContactNo,cityName:e.CityName,countryName:e.CountryName,price:{currency:e.Price.CurrencyCode,roomPrice:e.Price.RoomPrice,tax:e.Price.Tax,extraGuestCharge:e.Price.ExtraGuestCharge,childCharge:e.Price.ChildCharge,otherCharges:e.Price.OtherCharges,discount:e.Price.Discount,publishedPrice:e.Price.PublishedPrice,offeredPrice:e.Price.OfferedPrice,agentCommission:e.Price.AgentCommission,agentMarkUp:e.Price.AgentMarkUp},refundable:e.Refundable,mealType:e.MealType,roomType:e.RoomType,availableRooms:e.AvailableRooms,amenities:e.Amenities||[],hotelPicture:e.HotelPicture,hotelImages:e.HotelImages||[]}))}formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}matchMealType(e,t){const s=e.toLowerCase();switch(t){case 1:return s.includes("room only")||"ro"===s;case 2:return s.includes("breakfast")&&!s.includes("board");case 3:return s.includes("half board")||"hb"===s;case 4:return s.includes("full board")||"fb"===s;case 5:return s.includes("all inclusive")||"ai"===s;default:return!0}}createSession(e,t){this.currentSession={sessionId:this.generateSessionId(),searchCriteria:e,results:t,createdAt:new Date}}generateSessionId(){return`HOTEL-SEARCH-${Date.now()}-${Math.random().toString(36).substring(7)}`}handleSearchError(e,t){if(e instanceof Error){if(["Check-in and check-out dates are required","Check-in date cannot be in the past","Check-out date must be after check-in date","Either hotel codes or city code is required","Guest nationality is required","At least one room is required","Maximum 9 rooms can be searched at once","Each room must have at least one adult","Maximum 9 adults per room","Children count cannot be negative","Maximum 9 children per room","Children ages must be provided for all","Age must be a whole number","Age cannot be negative","Age must be 17 or under","Maximum 9 guests per room","Room "].some(t=>e.message.includes(t)))throw e}const s=this.getMockHotelData(t),r={hotels:s,searchCriteria:t,totalResults:s.length,isMockData:!0};return this.createSession(t,r),r}getMockHotelData(e){const t=[],s=8+Math.floor(5*Math.random()),r=["Grand Plaza Hotel","Sunset Beach Resort","City Center Inn","Royal Palace Hotel","Ocean View Resort","Mountain Lodge","Downtown Suites","Riverside Hotel","Garden Paradise Resort","Metropolitan Hotel","Lakeside Inn","Heritage Hotel"],a=["Room Only","Breakfast Included","Half Board","Full Board","All Inclusive"],i=["Standard Room","Deluxe Room","Suite","Executive Room","Family Room"],n=[["WiFi","Pool","Gym","Restaurant","Bar"],["WiFi","Spa","Restaurant","Room Service"],["WiFi","Parking","Business Center","Airport Shuttle"],["WiFi","Pool","Beach Access","Water Sports"],["WiFi","Gym","Restaurant","Conference Room"]];for(let o=0;o<s;o++){const s=3+Math.floor(3*Math.random()),l=80+50*(s-3)+Math.floor(100*Math.random()),c=Math.floor(.15*l),h=l+c,d=Math.floor(20*Math.random()),u=h-d;t.push({bookingCode:`MOCK-HOTEL-${Date.now()}-${o}`,hotelCode:`HTL${String(o+1).padStart(4,"0")}`,hotelName:r[o%r.length],starRating:s,address:`${100+o} Main Street, ${e.cityCode||"City"}`,contactNumber:`+1-555-${String(1e3+o).padStart(4,"0")}`,cityName:e.cityCode||"Mock City",countryName:"Mock Country",price:{currency:"USD",roomPrice:l,tax:c,extraGuestCharge:0,childCharge:0,otherCharges:0,discount:d,publishedPrice:h,offeredPrice:u,agentCommission:0,agentMarkUp:0},refundable:Math.random()>.3,mealType:a[Math.floor(Math.random()*a.length)],roomType:i[Math.floor(Math.random()*i.length)],availableRooms:1+Math.floor(5*Math.random()),amenities:n[Math.floor(Math.random()*n.length)],hotelPicture:`https://via.placeholder.com/400x300?text=${encodeURIComponent(r[o%r.length])}`,hotelImages:["https://via.placeholder.com/800x600?text=Image1","https://via.placeholder.com/800x600?text=Image2","https://via.placeholder.com/800x600?text=Image3"]})}return t}}let h=null;function d(){return h||(h=new c),h}d();const u=({onSearchComplete:s,onSearchError:r})=>{const a=d(),[i,n]=t.useState(!1),[o,l]=t.useState({}),[c,h]=t.useState(""),[u,m]=t.useState(""),[g,p]=t.useState(""),[x,f]=t.useState("US"),[y,j]=t.useState([{adults:2,children:0,childrenAges:[]}]),N=(e,t,s)=>{const r=[...y];if(("adults"===t||"children"===t)&&(r[e][t]=s,"children"===t)){const t=r[e].childrenAges;s>t.length?r[e].childrenAges=[...t,...Array(s-t.length).fill(5)]:r[e].childrenAges=t.slice(0,s)}j(r)};return e.jsxs("div",{className:"hotel-search-form",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h2",{children:"Search Hotels"}),e.jsx("p",{children:"Find the perfect accommodation for your stay"})]}),o.submit&&e.jsxs("div",{className:"error-message submit-error",children:[e.jsx("span",{className:"error-icon",children:"âš ï¸"}),o.submit]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(c.trim()||(e.location="Please enter a city code"),u){const t=new Date(u),s=new Date;s.setHours(0,0,0,0),t<s&&(e.checkIn="Check-in date cannot be in the past")}else e.checkIn="Please select a check-in date";if(g){if(u){const t=new Date(u);new Date(g)<=t&&(e.checkOut="Check-out date must be after check-in date")}}else e.checkOut="Please select a check-out date";if(x.trim()||(e.guestNationality="Please select guest nationality"),0===y.length)e.rooms="At least one room is required";else for(let t=0;t<y.length;t++){const s=y[t];if(s.adults<1){e.rooms=`Room ${t+1}: At least one adult is required`;break}if(s.children>0&&s.childrenAges.length!==s.children){e.rooms=`Room ${t+1}: Please provide ages for all children`;break}}return l(e),0===Object.keys(e).length})()){n(!0),l({});try{const e={checkIn:new Date(u),checkOut:new Date(g),cityCode:c.trim(),guestNationality:x.trim(),paxRooms:y.map(e=>({adults:e.adults,children:e.children,childrenAges:e.childrenAges})),isDetailedResponse:!0},t=await a.search(e);s&&s(t)}catch(t){const e=t instanceof Error?t.message:"Failed to search hotels. Please try again.";l({submit:e}),r&&r(e)}finally{n(!1)}}},className:"form-container",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"cityCode",children:["City Code ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"cityCode",type:"text",value:c,onChange:e=>h(e.target.value),placeholder:"e.g., NYC, LON, PAR",className:o.location?"error":"",disabled:i}),o.location&&e.jsx("span",{className:"error-text",children:o.location})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"checkIn",children:["Check-in Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"checkIn",type:"date",value:u,onChange:e=>m(e.target.value),min:(new Date).toISOString().split("T")[0],className:o.checkIn?"error":"",disabled:i}),o.checkIn&&e.jsx("span",{className:"error-text",children:o.checkIn})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"checkOut",children:["Check-out Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"checkOut",type:"date",value:g,onChange:e=>p(e.target.value),min:(()=>{if(!u)return"";const e=new Date(u);return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]})(),className:o.checkOut?"error":"",disabled:i}),o.checkOut&&e.jsx("span",{className:"error-text",children:o.checkOut})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"guestNationality",children:["Guest Nationality ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"guestNationality",value:x,onChange:e=>f(e.target.value),className:o.guestNationality?"error":"",disabled:i,children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"}),e.jsx("option",{value:"FR",children:"France"}),e.jsx("option",{value:"IT",children:"Italy"}),e.jsx("option",{value:"ES",children:"Spain"}),e.jsx("option",{value:"IN",children:"India"}),e.jsx("option",{value:"CN",children:"China"}),e.jsx("option",{value:"JP",children:"Japan"})]}),o.guestNationality&&e.jsx("span",{className:"error-text",children:o.guestNationality})]}),e.jsxs("div",{className:"rooms-section",children:[e.jsxs("div",{className:"rooms-header",children:[e.jsx("h3",{children:"Rooms & Guests"}),y.length<9&&e.jsx("button",{type:"button",onClick:()=>{y.length<9&&j([...y,{adults:2,children:0,childrenAges:[]}])},className:"btn-add-room",disabled:i,children:"+ Add Room"})]}),o.rooms&&e.jsx("span",{className:"error-text",children:o.rooms}),y.map((t,s)=>e.jsxs("div",{className:"room-config",children:[e.jsxs("div",{className:"room-header",children:[e.jsxs("h4",{children:["Room ",s+1]}),y.length>1&&e.jsx("button",{type:"button",onClick:()=>{return e=s,void(y.length>1&&j(y.filter((t,s)=>s!==e)));var e},className:"btn-remove-room",disabled:i,children:"Remove"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`adults-${s}`,children:"Adults"}),e.jsx("select",{id:`adults-${s}`,value:t.adults,onChange:e=>N(s,"adults",parseInt(e.target.value)),disabled:i,children:[1,2,3,4,5,6,7,8,9].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`children-${s}`,children:"Children"}),e.jsx("select",{id:`children-${s}`,value:t.children,onChange:e=>N(s,"children",parseInt(e.target.value)),disabled:i,children:[0,1,2,3,4,5,6,7,8,9].map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),t.children>0&&e.jsxs("div",{className:"children-ages",children:[e.jsx("label",{children:"Children Ages"}),e.jsx("div",{className:"ages-grid",children:t.childrenAges.map((t,r)=>e.jsxs("div",{className:"age-input",children:[e.jsxs("label",{htmlFor:`age-${s}-${r}`,children:["Child ",r+1]}),e.jsx("select",{id:`age-${s}-${r}`,value:t,onChange:e=>((e,t,s)=>{const r=[...y];r[e].childrenAges[t]=s,j(r)})(s,r,parseInt(e.target.value)),disabled:i,children:Array.from({length:18},(e,t)=>t).map(t=>e.jsx("option",{value:t,children:t},t))})]},r))})]})]},s))]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>{h(""),m(""),p(""),f("US"),j([{adults:2,children:0,childrenAges:[]}]),l({})},className:"btn secondary",disabled:i,children:"Reset"}),e.jsx("button",{type:"submit",className:"btn primary",disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ¨"}),"Search Hotels"]})})]})]})]})},m=({searchResult:s,onHotelSelect:r})=>{const a=d(),[i,n]=t.useState({}),[o,l]=t.useState("price"),c=t.useMemo(()=>{let e=a.filterResults(s.hotels,i);return e=[...e].sort((e,t)=>{switch(o){case"price":return e.price.offeredPrice-t.price.offeredPrice;case"rating":return t.starRating-e.starRating;case"name":return e.hotelName.localeCompare(t.hotelName);default:return 0}}),e},[s.hotels,i,o,a]),h=(e,t)=>{n(s=>({...s,[e]:""===t||void 0===t?void 0:t}))},u=()=>{n({})},m=Object.keys(i).some(e=>void 0!==i[e]);return e.jsxs("div",{className:"hotel-search-results",children:[s.isMockData&&e.jsxs("div",{className:"mock-mode-banner",children:[e.jsx("span",{className:"mock-icon",children:"â„¹ï¸"}),e.jsxs("div",{className:"mock-text",children:[e.jsx("strong",{children:"Demo Mode:"})," Showing sample hotel data. Real API is unavailable."]})]}),e.jsxs("div",{className:"results-header",children:[e.jsxs("h2",{children:[c.length," ",1===c.length?"Hotel":"Hotels"," Found"]}),e.jsx("p",{className:"search-summary",children:s.searchCriteria.cityCode&&`in ${s.searchCriteria.cityCode}`})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"filters-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"starRating",children:"Star Rating"}),e.jsxs("select",{id:"starRating",value:i.StarRating||"",onChange:e=>h("StarRating",e.target.value?parseInt(e.target.value):void 0),children:[e.jsx("option",{value:"",children:"All Ratings"}),e.jsx("option",{value:"5",children:"5 Stars"}),e.jsx("option",{value:"4",children:"4 Stars"}),e.jsx("option",{value:"3",children:"3 Stars"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"refundable",children:"Cancellation"}),e.jsxs("select",{id:"refundable",value:void 0===i.Refundable?"":i.Refundable?"true":"false",onChange:e=>h("Refundable",""===e.target.value?void 0:"true"===e.target.value),children:[e.jsx("option",{value:"",children:"All Hotels"}),e.jsx("option",{value:"true",children:"Refundable Only"}),e.jsx("option",{value:"false",children:"Non-Refundable"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"mealType",children:"Meal Plan"}),e.jsxs("select",{id:"mealType",value:i.MealType||"",onChange:e=>h("MealType",e.target.value?parseInt(e.target.value):void 0),children:[e.jsx("option",{value:"",children:"All Meal Plans"}),e.jsx("option",{value:"1",children:"Room Only"}),e.jsx("option",{value:"2",children:"Breakfast Included"}),e.jsx("option",{value:"3",children:"Half Board"}),e.jsx("option",{value:"4",children:"Full Board"}),e.jsx("option",{value:"5",children:"All Inclusive"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"sortBy",children:"Sort By"}),e.jsxs("select",{id:"sortBy",value:o,onChange:e=>l(e.target.value),children:[e.jsx("option",{value:"price",children:"Price (Low to High)"}),e.jsx("option",{value:"rating",children:"Star Rating (High to Low)"}),e.jsx("option",{value:"name",children:"Name (A-Z)"})]})]})]}),m&&e.jsx("button",{onClick:u,className:"btn-clear-filters",children:"Clear All Filters"})]}),c.length>0?e.jsx("div",{className:"hotels-grid",children:c.map(t=>e.jsx(g,{hotel:t,onSelect:()=>r?.(t)},t.bookingCode))}):e.jsxs("div",{className:"no-results",children:[e.jsx("div",{className:"no-results-icon",children:"ðŸ¨"}),e.jsx("h3",{children:"No Hotels Found"}),e.jsx("p",{children:"Try adjusting your filters or search criteria"}),m&&e.jsx("button",{onClick:u,className:"btn primary",children:"Clear Filters"})]})]})},g=({hotel:t,onSelect:s})=>e.jsxs("div",{className:"hotel-card",children:[e.jsxs("div",{className:"hotel-image",children:[e.jsx("img",{src:t.hotelPicture,alt:t.hotelName}),t.refundable&&e.jsx("span",{className:"refundable-badge",children:"Free Cancellation"})]}),e.jsxs("div",{className:"hotel-info",children:[e.jsxs("div",{className:"hotel-header",children:[e.jsx("h3",{className:"hotel-name",children:t.hotelName}),e.jsx("div",{className:"star-rating",children:Array.from({length:t.starRating},(t,s)=>e.jsx("span",{className:"star",children:"â­"},s))})]}),e.jsxs("p",{className:"hotel-location",children:["ðŸ“ ",t.address,", ",t.cityName]}),e.jsxs("div",{className:"hotel-details",children:[e.jsx("span",{className:"room-type",children:t.roomType}),e.jsxs("span",{className:"meal-type",children:["ðŸ½ï¸ ",t.mealType]})]}),t.amenities.length>0&&e.jsxs("div",{className:"amenities",children:[t.amenities.slice(0,4).map((t,s)=>e.jsx("span",{className:"amenity-tag",children:t},s)),t.amenities.length>4&&e.jsxs("span",{className:"amenity-tag more",children:["+",t.amenities.length-4," more"]})]}),e.jsxs("div",{className:"hotel-pricing",children:[e.jsxs("div",{className:"price-info",children:[t.price.discount>0&&e.jsxs("span",{className:"original-price",children:[t.price.currency," ",t.price.publishedPrice.toFixed(2)]}),e.jsxs("div",{className:"current-price",children:[e.jsx("span",{className:"currency",children:t.price.currency}),e.jsx("span",{className:"amount",children:t.price.offeredPrice.toFixed(2)})]}),e.jsx("span",{className:"price-label",children:"per night"})]}),e.jsx("button",{onClick:s,className:"btn-select",children:"View Details"})]}),t.availableRooms<=3&&e.jsxs("div",{className:"availability-warning",children:["Only ",t.availableRooms," room",1!==t.availableRooms?"s":""," left!"]})]})]}),p="hotel_booking_session";const x=new class{currentSession=null;timeoutId=null;startBooking(e,t){this.cancelSession();const s=new Date,r=new Date(s.getTime()+18e5),a={sessionId:this.generateSessionId(),hotel:e,searchCriteria:t,bookingCode:e.BookingCode,status:"details",createdAt:s,expiresAt:r};return this.currentSession=a,this.persistSession(a),this.scheduleSessionTimeout(),a}getCurrentSession(){return this.currentSession&&new Date>this.currentSession.expiresAt?(this.cancelSession(),null):this.currentSession}updateSession(e){if(!this.currentSession)throw new Error("No active hotel booking session");if(new Date>this.currentSession.expiresAt)throw this.cancelSession(),new Error("Hotel booking session has expired");this.currentSession={...this.currentSession,...e},this.persistSession(this.currentSession)}cancelSession(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.currentSession=null,this.clearPersistedSession()}async completeBooking(e,t){const s=this.getCurrentSession();if(!s)throw new Error("No active hotel booking session");if(!s.preBookResult)throw new Error("Pre-booking validation required before completing booking");const r={BookingCode:s.preBookResult.bookingCode,CustomerDetails:this.transformGuestDetailsToApiFormat(e),ClientReferenceId:this.generateClientReferenceId(),BookingReferenceId:this.generateBookingReferenceId(),TotalFare:s.preBookResult.currentPrice,EmailId:t.emailId||"",PhoneNumber:t.phoneNumber||"",BookingType:"API",PaymentMode:this.mapPaymentMethodToApiFormat(t.method)};try{const t=l(),a=await t.createBooking(r),i=this.generateBookingConfirmation(a,s,e);return this.updateSession({status:"confirmed"}),await this.integrateWithItinerary(i),i}catch(a){throw a}}transformGuestDetailsToApiFormat(e){return e.map(e=>({CustomerNames:e.customerNames.map(e=>({Title:e.title,FirstName:e.firstName,LastName:e.lastName,Type:e.type}))}))}generateBookingConfirmation(e,t,s){return{confirmationNumber:e.ConfirmationNo,bookingReferenceId:e.BookingRefNo,hotel:t.hotel,guestDetails:s,totalFare:e.HotelDetails.TotalFare,currency:e.HotelDetails.CurrencyCode,checkIn:t.searchCriteria.checkIn,checkOut:t.searchCriteria.checkOut,bookedAt:new Date,status:"Confirmed",voucherUrl:e.VoucherUrl}}async integrateWithItinerary(e){try{const{itineraryService:t}=await a(async()=>{const{itineraryService:e}=await import("./trip-planner-features-Cy4avEMv.js").then(e=>e.i);return{itineraryService:e}},__vite__mapDeps([0,1,2,3,4,5,6])),s={confirmationNumber:e.confirmationNumber,bookingReferenceId:e.bookingReferenceId,hotelName:e.hotel.hotelName,address:e.hotel.address,cityName:e.hotel.cityName,countryName:e.hotel.countryName,starRating:e.hotel.starRating,checkIn:e.checkIn,checkOut:e.checkOut,roomType:e.hotel.roomType,mealType:e.hotel.mealType,guests:e.guestDetails.flatMap(e=>e.customerNames.map(e=>`${e.title} ${e.firstName} ${e.lastName}`)),totalFare:e.totalFare,currency:e.currency,status:e.status,bookedAt:e.bookedAt,refundable:e.hotel.refundable};t.addHotelBooking(s);const r=this.getStoredHotelBookings();r.push(e),localStorage.setItem("hotel_bookings",JSON.stringify(r))}catch(t){}}getStoredHotelBookings(){try{const e=localStorage.getItem("hotel_bookings");return e?JSON.parse(e):[]}catch(e){return[]}}mapPaymentMethodToApiFormat(e){return{credit_card:"Limit",debit_card:"Limit",upi:"Limit",net_banking:"Limit"}[e]||"Limit"}generateClientReferenceId(){return`TS_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}generateBookingReferenceId(){return`BOOK_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}restoreSession(){try{const e=localStorage.getItem(p);if(!e)return null;const t=JSON.parse(e);return t.createdAt=new Date(t.createdAt),t.expiresAt=new Date(t.expiresAt),t.searchCriteria.checkIn=new Date(t.searchCriteria.checkIn),t.searchCriteria.checkOut=new Date(t.searchCriteria.checkOut),new Date>t.expiresAt?(this.clearPersistedSession(),null):(this.currentSession=t,this.scheduleSessionTimeout(),t)}catch(e){return this.clearPersistedSession(),null}}generateSessionId(){return`hotel_session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}persistSession(e){try{localStorage.setItem(p,JSON.stringify(e))}catch(t){}}clearPersistedSession(){try{localStorage.removeItem(p)}catch(e){}}scheduleSessionTimeout(){if(this.timeoutId&&clearTimeout(this.timeoutId),!this.currentSession)return;const e=this.currentSession.expiresAt.getTime()-Date.now();e>0&&(this.timeoutId=setTimeout(()=>{this.cancelSession()},e))}},f=({session:s,onComplete:r,onCancel:a})=>{const[i,n]=t.useState(()=>{const e=s.status;return"search"===e?"details":e}),[o,l]=t.useState(s);t.useEffect(()=>{const e=x.getCurrentSession();if(e){l(e);const t=e.status;n("search"===t?"details":t)}},[]),t.useEffect(()=>{try{x.updateSession({status:i})}catch(e){}},[i]);const c=[{key:"details",label:"Hotel Details"},{key:"prebook",label:"Verify Pricing"},{key:"guest_details",label:"Guest Details"},{key:"payment",label:"Payment"},{key:"confirmed",label:"Confirmation"}],h=c.findIndex(e=>e.key===i);return e.jsxs("div",{className:"hotel-booking-workflow",children:[e.jsx("div",{className:"workflow-progress",children:e.jsx("div",{className:"progress-steps",children:c.map((t,s)=>e.jsxs("div",{className:"progress-step "+(s<h?"completed":s===h?"active":"pending"),children:[e.jsx("div",{className:"step-indicator",children:s<h?e.jsx("span",{className:"step-check",children:"âœ“"}):e.jsx("span",{className:"step-number",children:s+1})}),e.jsx("div",{className:"step-label",children:t.label}),s<c.length-1&&e.jsx("div",{className:"step-connector"})]},t.key))})}),e.jsx("div",{className:"workflow-content",children:e.jsxs("div",{className:"step-placeholder",children:[e.jsxs("h3",{children:["Step: ",c[h].label]}),e.jsxs("p",{children:["Current step: ",i]}),e.jsxs("p",{children:["Hotel: ",o.hotel.HotelName]}),e.jsxs("p",{children:["Check-in: ",o.searchCriteria.checkIn.toLocaleDateString()]}),e.jsxs("p",{children:["Check-out: ",o.searchCriteria.checkOut.toLocaleDateString()]})]})}),e.jsxs("div",{className:"workflow-actions",children:[e.jsx("button",{type:"button",onClick:()=>{x.cancelSession(),a?.()},className:"btn-cancel",children:"Cancel Booking"}),e.jsxs("div",{className:"workflow-nav-buttons",children:[h>0&&"confirmed"!==i&&e.jsx("button",{type:"button",onClick:()=>{const e=h-1;e>=0&&n(c[e].key)},className:"btn-back",children:"Back"}),"confirmed"!==i&&e.jsx("button",{type:"button",onClick:()=>{const e=h+1;e<c.length&&n(c[e].key)},className:"btn-next",children:h===c.length-2?"Complete Booking":"Continue"})]})]})]})},y=()=>{const r=s(),[a,i]=t.useState(null),[n,o]=t.useState(null);t.useEffect(()=>{const e=x.getCurrentSession();e&&i(e)},[]);return e.jsxs("div",{className:"hotel-booking-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Book Hotels"}),e.jsx("p",{children:"Find and book the perfect accommodation for your trip"})]}),a?e.jsx(f,{session:a,onComplete:e=>{r(`/itinerary?booking=${e}`)},onCancel:()=>{x.cancelSession(),i(null)}}):n?e.jsxs("div",{children:[e.jsx("button",{className:"back-button",onClick:()=>{o(null)},style:{marginBottom:"1rem"},children:"â† Back to Search"}),e.jsx(m,{searchResult:n,onHotelSelect:e=>{if(n){const t=x.startBooking(e,n.searchCriteria);i(t),o(null)}}})]}):e.jsx(u,{onSearchComplete:e=>{o(e)}})]})};export{y as default};
//# sourceMappingURL=HotelBookingPage-DJwxzcwd.js.map
