{"version":3,"mappings":"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","names":["DEFAULT_CONFIG","baseUrl","username","password","timeout","retryAttempts","retryDelay","TboHotelApiClient","client","config","constructor","this","createAxiosInstance","setupInterceptors","axios","create","baseURL","headers","Accept","auth","interceptors","request","use","error","Promise","reject","response","data","Status","message","Message","createApiError","async","handleResponseError","_retryCount","shouldRetryRequest","delay","Math","pow","sleep","code","originalError","retryCount","includes","status","details","recoverable","isRecoverableError","ms","resolve","setTimeout","searchHotels","post","getHotelDetails","preBook","createBooking","getBookingDetails","getBookingsByDateRange","cancelBooking","getCountryList","get","getCityList","getHotelCodeList","healthCheck","apiClientInstance","getTboHotelApiClient","HotelSearchService","apiClient","currentSession","search","criteria","validateSearchCriteria","transformToApiRequest","Hotels","hotels","transformHotelsToInternalModel","result","searchCriteria","totalResults","length","isMockData","createSession","Error","handleSearchError","filterResults","results","filters","Object","keys","filter","hotel","Refundable","refundable","StarRating","starRating","MealType","matchMealType","mealType","HotelName","trim","hotelNameLower","hotelName","toLowerCase","filterNameLower","NoOfRooms","availableRooms","getCurrentSearchSession","clearSession","checkIn","checkOut","Date","today","setHours","hotelCodes","cityCode","guestNationality","paxRooms","i","room","roomNumber","adults","children","childrenAges","j","age","Number","isInteger","totalOccupancy","CheckIn","formatDate","CheckOut","HotelCodes","CityCode","GuestNationality","PaxRooms","map","Adults","Children","ChildrenAges","ResponseTime","responseTime","IsDetailedResponse","isDetailedResponse","Filters","bookingCode","BookingCode","hotelCode","HotelCode","address","HotelAddress","contactNumber","HotelContactNo","cityName","CityName","countryName","CountryName","price","currency","Price","CurrencyCode","roomPrice","RoomPrice","tax","Tax","extraGuestCharge","ExtraGuestCharge","childCharge","ChildCharge","otherCharges","OtherCharges","discount","Discount","publishedPrice","PublishedPrice","offeredPrice","OfferedPrice","agentCommission","AgentCommission","agentMarkUp","AgentMarkUp","roomType","RoomType","AvailableRooms","amenities","Amenities","hotelPicture","HotelPicture","hotelImages","HotelImages","date","d","getFullYear","String","getMonth","padStart","getDate","hotelMealType","filterMealType","mealTypeLower","sessionId","generateSessionId","createdAt","now","random","toString","substring","some","msg","mockHotels","getMockHotelData","hotelCount","floor","hotelNames","mealTypes","roomTypes","basePrice","push","encodeURIComponent","hotelSearchServiceInstance","getHotelSearchService","HotelSearchForm","onSearchComplete","onSearchError","hotelSearchService","isLoading","setIsLoading","useState","errors","setErrors","setCityCode","setCheckIn","setCheckOut","setGuestNationality","rooms","setRooms","handleRoomChange","index","field","value","newRooms","currentAges","Array","fill","slice","jsxs","className","jsx","submit","onSubmit","e","preventDefault","newErrors","location","checkInDate","validateForm","errorMessage","htmlFor","id","type","onChange","target","placeholder","disabled","min","toISOString","split","setDate","getMinCheckOutDate","onClick","roomIndex","handleRemoveRoom","_","parseInt","num","childIndex","handleChildAgeChange","from","Fragment","HotelSearchResults","searchResult","onHotelSelect","setFilters","sortBy","setSortBy","filteredAndSortedHotels","useMemo","filtered","sort","a","b","localeCompare","handleFilterChange","filterKey","prev","handleClearFilters","hasActiveFilters","key","HotelCard","onSelect","src","alt","amenity","toFixed","SESSION_STORAGE_KEY","hotelBookingService","timeoutId","startBooking","cancelSession","expiresAt","getTime","SESSION_TIMEOUT_MINUTES","session","persistSession","scheduleSessionTimeout","getCurrentSession","updateSession","stepData","clearTimeout","clearPersistedSession","completeBooking","guestDetails","paymentInfo","preBookResult","bookingRequest","CustomerDetails","transformGuestDetailsToApiFormat","ClientReferenceId","generateClientReferenceId","BookingReferenceId","generateBookingReferenceId","TotalFare","currentPrice","EmailId","emailId","PhoneNumber","phoneNumber","BookingType","PaymentMode","mapPaymentMethodToApiFormat","method","confirmation","generateBookingConfirmation","integrateWithItinerary","CustomerNames","customerNames","customer","Title","title","FirstName","firstName","LastName","lastName","Type","confirmationNumber","ConfirmationNo","bookingReferenceId","BookingRefNo","totalFare","HotelDetails","bookedAt","voucherUrl","VoucherUrl","itineraryService","__vitePreload","import","then","n","__VITE_PRELOAD__","hotelBooking","guests","flatMap","guest","addHotelBooking","existingBookings","getStoredHotelBookings","localStorage","setItem","JSON","stringify","stored","getItem","parse","credit_card","debit_card","upi","net_banking","restoreSession","removeItem","timeUntilExpiry","HotelBookingWorkflow","initialSession","onComplete","onCancel","currentStep","setCurrentStep","setSession","useEffect","restoredSession","steps","label","currentStepIndex","findIndex","s","step","toLocaleDateString","prevIndex","nextIndex","HotelBookingPage","navigate","useNavigate","searchResults","setSearchResults","activeSession","style","marginBottom","newSession"],"ignoreList":[],"sources":["../../src/services/api/tboHotelApiClient.ts","../../src/services/hotelSearchService.ts","../../src/components/hotel/HotelSearchForm.tsx","../../src/components/hotel/HotelSearchResults.tsx","../../src/services/hotelBookingService.ts","../../src/components/hotel/HotelBookingWorkflow.tsx","../../src/pages/HotelBookingPage.tsx"],"sourcesContent":["/**\n * TBO Hotel API Client\n * \n * This module provides a configured Axios client for communicating with the\n * TBO Hotel API. It includes:\n * - Basic Authentication (username/password)\n * - Automatic retry logic with exponential backoff (3 attempts)\n * - Request/response interceptors for error handling\n * - Timeout configuration (10 seconds)\n */\n\nimport axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';\nimport type {\n  ApiConfig,\n  HotelSearchRequest,\n  HotelSearchResponse,\n  HotelDetailsRequest,\n  HotelDetailsResponse,\n  PreBookRequest,\n  PreBookResponse,\n  HotelBookingRequest,\n  HotelBookingResponse,\n  BookingDetailRequest,\n  BookingDetailResponse,\n  BookingListRequest,\n  BookingListResponse,\n  CancelRequest,\n  CancelResponse,\n  CountryListResponse,\n  CityListRequest,\n  CityListResponse,\n  HotelCodeListRequest,\n  HotelCodeListResponse,\n  ApiErrorResponse,\n} from '../../types/tboHotelApi';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nconst DEFAULT_CONFIG: ApiConfig = {\n  baseUrl: import.meta.env.VITE_TBO_HOTEL_API_URL || 'http://api.tbotechnology.in/TBOHolidays_HotelAPI',\n  username: import.meta.env.VITE_TBO_HOTEL_USERNAME || '',\n  password: import.meta.env.VITE_TBO_HOTEL_PASSWORD || '',\n  timeout: 10000, // 10 seconds as per requirements\n  retryAttempts: 3,\n  retryDelay: 1000, // Initial delay of 1 second\n};\n\n// ============================================================================\n// API Client Class\n// ============================================================================\n\nexport class TboHotelApiClient {\n  private client: AxiosInstance;\n  private config: ApiConfig;\n\n  constructor(config: Partial<ApiConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.client = this.createAxiosInstance();\n    this.setupInterceptors();\n  }\n\n  /**\n   * Creates the Axios instance with base configuration\n   */\n  private createAxiosInstance(): AxiosInstance {\n    return axios.create({\n      baseURL: this.config.baseUrl,\n      timeout: this.config.timeout,\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n      },\n      // Basic Authentication\n      auth: {\n        username: this.config.username,\n        password: this.config.password,\n      },\n    });\n  }\n\n  /**\n   * Sets up request and response interceptors\n   */\n  private setupInterceptors(): void {\n    // Request interceptor - log requests in development\n    this.client.interceptors.request.use(\n      (config: InternalAxiosRequestConfig) => {\n        // Add any request modifications here if needed\n        return config;\n      },\n      (error) => {\n        return Promise.reject(error);\n      }\n    );\n\n    // Response interceptor - handle errors\n    this.client.interceptors.response.use(\n      (response) => {\n        // Check for API-level errors in response\n        if (response.data?.Status === 0 || response.data?.Status === 2) {\n          const message = response.data.Message || 'API request failed';\n          throw this.createApiError('API_ERROR', message);\n        }\n        return response;\n      },\n      async (error: AxiosError) => {\n        return this.handleResponseError(error);\n      }\n    );\n  }\n\n  /**\n   * Handles response errors with retry logic\n   */\n  private async handleResponseError(error: AxiosError): Promise<never> {\n    const config = error.config as InternalAxiosRequestConfig & { _retryCount?: number };\n    \n    if (!config) {\n      throw this.createApiError('NETWORK_ERROR', 'Network request failed');\n    }\n\n    // Initialize retry count\n    config._retryCount = config._retryCount || 0;\n\n    // Check if we should retry\n    const shouldRetry = this.shouldRetryRequest(error, config._retryCount);\n\n    if (shouldRetry && config._retryCount < this.config.retryAttempts) {\n      config._retryCount += 1;\n      \n      // Calculate exponential backoff delay\n      const delay = this.config.retryDelay * Math.pow(2, config._retryCount - 1);\n      \n      // Wait before retrying\n      await this.sleep(delay);\n      \n      // Retry the request\n      return this.client.request(config);\n    }\n\n    // Max retries reached or non-retryable error\n    throw this.createApiError(\n      error.code || 'UNKNOWN_ERROR',\n      error.message || 'An unknown error occurred',\n      { originalError: error }\n    );\n  }\n\n  /**\n   * Determines if a request should be retried\n   */\n  private shouldRetryRequest(error: AxiosError, retryCount: number): boolean {\n    // Don't retry if max attempts reached\n    if (retryCount >= this.config.retryAttempts) {\n      return false;\n    }\n\n    // Retry on network errors\n    if (!error.response) {\n      return true;\n    }\n\n    // Retry on specific HTTP status codes\n    const retryableStatusCodes = [408, 429, 500, 502, 503, 504];\n    return retryableStatusCodes.includes(error.response.status);\n  }\n\n  /**\n   * Creates a standardized API error\n   */\n  private createApiError(code: string, message: string, details?: Record<string, any>): ApiErrorResponse {\n    return {\n      error: {\n        code,\n        message,\n        details,\n      },\n      recoverable: this.isRecoverableError(code),\n    };\n  }\n\n  /**\n   * Determines if an error is recoverable\n   */\n  private isRecoverableError(code: string): boolean {\n    const recoverableErrors = [\n      'NETWORK_ERROR',\n      'TIMEOUT',\n      'ECONNABORTED',\n      'ECONNRESET',\n      'ETIMEDOUT',\n      '408',\n      '429',\n      '500',\n      '502',\n      '503',\n      '504',\n    ];\n    return recoverableErrors.includes(code);\n  }\n\n  /**\n   * Sleep utility for retry delays\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  // ============================================================================\n  // API Methods\n  // ============================================================================\n\n  /**\n   * Search for hotels\n   */\n  async searchHotels(request: HotelSearchRequest): Promise<HotelSearchResponse> {\n    const response = await this.client.post<HotelSearchResponse>('/search', request);\n    return response.data;\n  }\n\n  /**\n   * Get detailed hotel information\n   */\n  async getHotelDetails(request: HotelDetailsRequest): Promise<HotelDetailsResponse> {\n    const response = await this.client.post<HotelDetailsResponse>('/Hoteldetails', request);\n    return response.data;\n  }\n\n  /**\n   * Pre-book validation - validates availability and pricing before final booking\n   */\n  async preBook(request: PreBookRequest): Promise<PreBookResponse> {\n    const response = await this.client.post<PreBookResponse>('/PreBook', request);\n    return response.data;\n  }\n\n  /**\n   * Create a hotel booking\n   */\n  async createBooking(request: HotelBookingRequest): Promise<HotelBookingResponse> {\n    const response = await this.client.post<HotelBookingResponse>('/Book', request);\n    return response.data;\n  }\n\n  /**\n   * Get booking details by confirmation number or booking reference\n   */\n  async getBookingDetails(request: BookingDetailRequest): Promise<BookingDetailResponse> {\n    const response = await this.client.post<BookingDetailResponse>('/BookingDetail', request);\n    return response.data;\n  }\n\n  /**\n   * Get bookings within a date range\n   */\n  async getBookingsByDateRange(request: BookingListRequest): Promise<BookingListResponse> {\n    const response = await this.client.post<BookingListResponse>('/BookingDetailsBasedOnDate', request);\n    return response.data;\n  }\n\n  /**\n   * Cancel a hotel booking\n   */\n  async cancelBooking(request: CancelRequest): Promise<CancelResponse> {\n    const response = await this.client.post<CancelResponse>('/Cancel', request);\n    return response.data;\n  }\n\n  /**\n   * Get list of countries\n   */\n  async getCountryList(): Promise<CountryListResponse> {\n    const response = await this.client.get<CountryListResponse>('/CountryList');\n    return response.data;\n  }\n\n  /**\n   * Get list of cities in a country\n   */\n  async getCityList(request: CityListRequest): Promise<CityListResponse> {\n    const response = await this.client.post<CityListResponse>('/CityList', request);\n    return response.data;\n  }\n\n  /**\n   * Get list of hotels in a city\n   */\n  async getHotelCodeList(request: HotelCodeListRequest): Promise<HotelCodeListResponse> {\n    const response = await this.client.post<HotelCodeListResponse>('/TBOHotelCodeList', request);\n    return response.data;\n  }\n\n  /**\n   * Health check to verify API availability\n   */\n  async healthCheck(): Promise<boolean> {\n    try {\n      // Use CountryList as a simple health check endpoint\n      await this.getCountryList();\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet apiClientInstance: TboHotelApiClient | null = null;\n\n/**\n * Gets the singleton API client instance\n */\nexport function getTboHotelApiClient(config?: Partial<ApiConfig>): TboHotelApiClient {\n  if (!apiClientInstance) {\n    apiClientInstance = new TboHotelApiClient(config);\n  }\n  return apiClientInstance;\n}\n\n/**\n * Resets the singleton instance (useful for testing)\n */\nexport function resetApiClient(): void {\n  apiClientInstance = null;\n}\n\n// Export default instance\nexport default getTboHotelApiClient();\n","/**\n * Hotel Search Service\n * \n * Provides hotel search functionality with:\n * - Search by location, dates, and guest requirements\n * - BookingCode extraction and storage\n * - API response transformation to internal model\n * - Mock fallback for API failures\n * - Session management for search results\n * \n * Requirements: 1.1, 1.2, 1.4, 1.7\n */\n\nimport { getTboHotelApiClient } from './api/tboHotelApiClient';\nimport { mockFallbackHandler } from './mockFallbackHandler';\nimport type {\n  HotelSearchRequest,\n  HotelSearchResponse,\n  Hotel,\n  PaxRoom,\n  HotelSearchFilters,\n} from '../types/tboHotelApi';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface HotelSearchCriteria {\n  checkIn: Date;\n  checkOut: Date;\n  hotelCodes?: string; // Comma-separated hotel codes\n  cityCode?: string;\n  guestNationality: string;\n  paxRooms: PaxRoomInput[];\n  responseTime?: number;\n  isDetailedResponse?: boolean;\n  filters?: HotelSearchFilters;\n}\n\nexport interface PaxRoomInput {\n  adults: number;\n  children: number;\n  childrenAges: number[];\n}\n\nexport interface HotelResult {\n  bookingCode: string;\n  hotelCode: string;\n  hotelName: string;\n  starRating: number;\n  address: string;\n  contactNumber: string;\n  cityName: string;\n  countryName: string;\n  price: {\n    currency: string;\n    roomPrice: number;\n    tax: number;\n    extraGuestCharge: number;\n    childCharge: number;\n    otherCharges: number;\n    discount: number;\n    publishedPrice: number;\n    offeredPrice: number;\n    agentCommission: number;\n    agentMarkUp: number;\n  };\n  refundable: boolean;\n  mealType: string;\n  roomType: string;\n  availableRooms: number;\n  amenities: string[];\n  hotelPicture: string;\n  hotelImages: string[];\n}\n\nexport interface HotelSearchResult {\n  hotels: HotelResult[];\n  searchCriteria: HotelSearchCriteria;\n  totalResults: number;\n  isMockData: boolean;\n}\n\nexport interface HotelSearchSession {\n  sessionId: string;\n  searchCriteria: HotelSearchCriteria;\n  results: HotelSearchResult;\n  createdAt: Date;\n}\n\n// ============================================================================\n// Hotel Search Service Class\n// ============================================================================\n\nexport class HotelSearchService {\n  private apiClient = getTboHotelApiClient();\n  private currentSession: HotelSearchSession | null = null;\n\n  /**\n   * Search for hotels based on criteria\n   * Requirement 1.1: Call TBO Hotel API search endpoint and return available hotels\n   * Requirement 1.2: Parse hotel information including name, location, price, star rating, and amenities\n   * Requirement 1.4: Include room details, pricing, and availability for each hotel\n   * Requirement 1.7: Extract and store BookingCode for each hotel option\n   */\n  async search(criteria: HotelSearchCriteria): Promise<HotelSearchResult> {\n    // Validate search criteria (throw validation errors immediately)\n    this.validateSearchCriteria(criteria);\n\n    try {\n      // Transform criteria to API request format\n      const request = this.transformToApiRequest(criteria);\n\n      // Call the API\n      const response: HotelSearchResponse = await this.apiClient.searchHotels(request);\n\n      // Check if API returned success\n      if (response.Status === 1 && response.Hotels) {\n        // Transform API response to internal model\n        const hotels = this.transformHotelsToInternalModel(response.Hotels);\n\n        const result: HotelSearchResult = {\n          hotels,\n          searchCriteria: criteria,\n          totalResults: hotels.length,\n          isMockData: false,\n        };\n\n        // Store in session\n        this.createSession(criteria, result);\n\n        return result;\n      }\n\n      // API returned error status\n      throw new Error(response.Message || 'Hotel search failed');\n\n    } catch (error) {\n      // Requirement 1.5: Mock fallback for API failures\n      return this.handleSearchError(error, criteria);\n    }\n  }\n\n  /**\n   * Filter hotel results client-side without additional API calls\n   * Requirement 1.3: Filter results by refundable, star rating, meal type\n   * \n   * @param results - Array of hotel results to filter\n   * @param filters - Filter criteria to apply (AND conditions)\n   * @returns Filtered array of hotel results\n   */\n  filterResults(results: HotelResult[], filters: HotelSearchFilters): HotelResult[] {\n    if (!filters || Object.keys(filters).length === 0) {\n      return results;\n    }\n\n    return results.filter(hotel => {\n      // Filter by refundable status\n      if (filters.Refundable !== undefined && hotel.refundable !== filters.Refundable) {\n        return false;\n      }\n\n      // Filter by star rating\n      if (filters.StarRating !== undefined && hotel.starRating !== filters.StarRating) {\n        return false;\n      }\n\n      // Filter by meal type (match meal type string)\n      if (filters.MealType !== undefined) {\n        const mealTypeMatch = this.matchMealType(hotel.mealType, filters.MealType);\n        if (!mealTypeMatch) {\n          return false;\n        }\n      }\n\n      // Filter by hotel name (case-insensitive partial match)\n      if (filters.HotelName && filters.HotelName.trim() !== '') {\n        const hotelNameLower = hotel.hotelName.toLowerCase();\n        const filterNameLower = filters.HotelName.toLowerCase();\n        if (!hotelNameLower.includes(filterNameLower)) {\n          return false;\n        }\n      }\n\n      // Filter by number of rooms (available rooms >= requested)\n      if (filters.NoOfRooms !== undefined && hotel.availableRooms < filters.NoOfRooms) {\n        return false;\n      }\n\n      // All filters passed\n      return true;\n    });\n  }\n\n  /**\n   * Get the current search session\n   */\n  getCurrentSearchSession(): HotelSearchSession | null {\n    return this.currentSession;\n  }\n\n  /**\n   * Clear the current search session\n   */\n  clearSession(): void {\n    this.currentSession = null;\n  }\n\n  // ============================================================================\n  // Private Helper Methods\n  // ============================================================================\n\n  /**\n   * Validate search criteria\n   */\n  private validateSearchCriteria(criteria: HotelSearchCriteria): void {\n    // Validate dates\n    if (!criteria.checkIn || !criteria.checkOut) {\n      throw new Error('Check-in and check-out dates are required');\n    }\n\n    const checkIn = new Date(criteria.checkIn);\n    const checkOut = new Date(criteria.checkOut);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    if (checkIn < today) {\n      throw new Error('Check-in date cannot be in the past');\n    }\n\n    if (checkOut <= checkIn) {\n      throw new Error('Check-out date must be after check-in date');\n    }\n\n    // Validate location\n    if (!criteria.hotelCodes && !criteria.cityCode) {\n      throw new Error('Either hotel codes or city code is required');\n    }\n\n    // Validate guest nationality\n    if (!criteria.guestNationality) {\n      throw new Error('Guest nationality is required');\n    }\n\n    // Validate rooms and guests\n    if (!criteria.paxRooms || criteria.paxRooms.length === 0) {\n      throw new Error('At least one room is required');\n    }\n\n    // Validate maximum number of rooms (reasonable limit)\n    if (criteria.paxRooms.length > 9) {\n      throw new Error('Maximum 9 rooms can be searched at once');\n    }\n\n    // Validate each room configuration\n    for (let i = 0; i < criteria.paxRooms.length; i++) {\n      const room = criteria.paxRooms[i];\n      const roomNumber = i + 1;\n\n      // Validate adults count\n      if (room.adults < 1) {\n        throw new Error(`Room ${roomNumber}: Each room must have at least one adult`);\n      }\n\n      if (room.adults > 9) {\n        throw new Error(`Room ${roomNumber}: Maximum 9 adults per room`);\n      }\n\n      // Validate children count\n      if (room.children < 0) {\n        throw new Error(`Room ${roomNumber}: Children count cannot be negative`);\n      }\n\n      if (room.children > 9) {\n        throw new Error(`Room ${roomNumber}: Maximum 9 children per room`);\n      }\n\n      // Validate children ages array\n      if (room.children > 0 && room.childrenAges.length !== room.children) {\n        throw new Error(\n          `Room ${roomNumber}: Children ages must be provided for all ${room.children} children (received ${room.childrenAges.length} ages)`\n        );\n      }\n\n      // Validate each child's age\n      if (room.children > 0) {\n        for (let j = 0; j < room.childrenAges.length; j++) {\n          const age = room.childrenAges[j];\n          \n          if (!Number.isInteger(age)) {\n            throw new Error(`Room ${roomNumber}, Child ${j + 1}: Age must be a whole number`);\n          }\n\n          if (age < 0) {\n            throw new Error(`Room ${roomNumber}, Child ${j + 1}: Age cannot be negative`);\n          }\n\n          if (age > 17) {\n            throw new Error(`Room ${roomNumber}, Child ${j + 1}: Age must be 17 or under (use adult for 18+)`);\n          }\n        }\n      }\n\n      // Validate total occupancy per room\n      const totalOccupancy = room.adults + room.children;\n      if (totalOccupancy > 9) {\n        throw new Error(`Room ${roomNumber}: Maximum 9 guests per room (${room.adults} adults + ${room.children} children = ${totalOccupancy})`);\n      }\n    }\n  }\n\n  /**\n   * Transform search criteria to API request format\n   */\n  private transformToApiRequest(criteria: HotelSearchCriteria): HotelSearchRequest {\n    return {\n      CheckIn: this.formatDate(criteria.checkIn),\n      CheckOut: this.formatDate(criteria.checkOut),\n      HotelCodes: criteria.hotelCodes,\n      CityCode: criteria.cityCode,\n      GuestNationality: criteria.guestNationality,\n      PaxRooms: criteria.paxRooms.map(room => ({\n        Adults: room.adults,\n        Children: room.children,\n        ChildrenAges: room.childrenAges,\n      })),\n      ResponseTime: criteria.responseTime,\n      IsDetailedResponse: criteria.isDetailedResponse,\n      Filters: criteria.filters,\n    };\n  }\n\n  /**\n   * Transform API hotels to internal model\n   * Requirement 1.7: Extract and store BookingCode from API response\n   */\n  private transformHotelsToInternalModel(hotels: Hotel[]): HotelResult[] {\n    return hotels.map(hotel => ({\n      bookingCode: hotel.BookingCode, // Extract BookingCode\n      hotelCode: hotel.HotelCode,\n      hotelName: hotel.HotelName,\n      starRating: hotel.StarRating,\n      address: hotel.HotelAddress,\n      contactNumber: hotel.HotelContactNo,\n      cityName: hotel.CityName,\n      countryName: hotel.CountryName,\n      price: {\n        currency: hotel.Price.CurrencyCode,\n        roomPrice: hotel.Price.RoomPrice,\n        tax: hotel.Price.Tax,\n        extraGuestCharge: hotel.Price.ExtraGuestCharge,\n        childCharge: hotel.Price.ChildCharge,\n        otherCharges: hotel.Price.OtherCharges,\n        discount: hotel.Price.Discount,\n        publishedPrice: hotel.Price.PublishedPrice,\n        offeredPrice: hotel.Price.OfferedPrice,\n        agentCommission: hotel.Price.AgentCommission,\n        agentMarkUp: hotel.Price.AgentMarkUp,\n      },\n      refundable: hotel.Refundable,\n      mealType: hotel.MealType,\n      roomType: hotel.RoomType,\n      availableRooms: hotel.AvailableRooms,\n      amenities: hotel.Amenities || [],\n      hotelPicture: hotel.HotelPicture,\n      hotelImages: hotel.HotelImages || [],\n    }));\n  }\n\n  /**\n   * Format date to YYYY-MM-DD format required by API\n   */\n  private formatDate(date: Date): string {\n    const d = new Date(date);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  }\n\n  /**\n   * Match meal type filter to hotel meal type string\n   * Meal type codes (based on common hotel API patterns):\n   * 1 = Room Only\n   * 2 = Breakfast Included\n   * 3 = Half Board (Breakfast + Dinner)\n   * 4 = Full Board (Breakfast + Lunch + Dinner)\n   * 5 = All Inclusive\n   */\n  private matchMealType(hotelMealType: string, filterMealType: number): boolean {\n    const mealTypeLower = hotelMealType.toLowerCase();\n\n    switch (filterMealType) {\n      case 1:\n        return mealTypeLower.includes('room only') || mealTypeLower === 'ro';\n      case 2:\n        return mealTypeLower.includes('breakfast') && !mealTypeLower.includes('board');\n      case 3:\n        return mealTypeLower.includes('half board') || mealTypeLower === 'hb';\n      case 4:\n        return mealTypeLower.includes('full board') || mealTypeLower === 'fb';\n      case 5:\n        return mealTypeLower.includes('all inclusive') || mealTypeLower === 'ai';\n      default:\n        return true; // Unknown meal type, don't filter\n    }\n  }\n\n  /**\n   * Create a new search session\n   */\n  private createSession(criteria: HotelSearchCriteria, result: HotelSearchResult): void {\n    this.currentSession = {\n      sessionId: this.generateSessionId(),\n      searchCriteria: criteria,\n      results: result,\n      createdAt: new Date(),\n    };\n  }\n\n  /**\n   * Generate a unique session ID\n   */\n  private generateSessionId(): string {\n    return `HOTEL-SEARCH-${Date.now()}-${Math.random().toString(36).substring(7)}`;\n  }\n\n  /**\n   * Handle search errors with mock fallback\n   * Requirement 1.5: Return mock hotel data when API fails\n   */\n  private handleSearchError(error: unknown, criteria: HotelSearchCriteria): HotelSearchResult {\n    // Re-throw validation errors (don't use mock data for validation failures)\n    if (error instanceof Error) {\n      const validationErrors = [\n        'Check-in and check-out dates are required',\n        'Check-in date cannot be in the past',\n        'Check-out date must be after check-in date',\n        'Either hotel codes or city code is required',\n        'Guest nationality is required',\n        'At least one room is required',\n        'Maximum 9 rooms can be searched at once',\n        'Each room must have at least one adult',\n        'Maximum 9 adults per room',\n        'Children count cannot be negative',\n        'Maximum 9 children per room',\n        'Children ages must be provided for all',\n        'Age must be a whole number',\n        'Age cannot be negative',\n        'Age must be 17 or under',\n        'Maximum 9 guests per room',\n        'Room ',\n      ];\n      \n      if (validationErrors.some(msg => error.message.includes(msg))) {\n        throw error;\n      }\n    }\n\n    console.warn('Hotel search API failed, using mock data:', error);\n\n    // Get mock hotel data\n    const mockHotels = this.getMockHotelData(criteria);\n\n    const result: HotelSearchResult = {\n      hotels: mockHotels,\n      searchCriteria: criteria,\n      totalResults: mockHotels.length,\n      isMockData: true,\n    };\n\n    // Store in session\n    this.createSession(criteria, result);\n\n    return result;\n  }\n\n  /**\n   * Generate mock hotel data for fallback\n   */\n  private getMockHotelData(criteria: HotelSearchCriteria): HotelResult[] {\n    const mockHotels: HotelResult[] = [];\n    const hotelCount = 8 + Math.floor(Math.random() * 5); // 8-12 hotels\n\n    const hotelNames = [\n      'Grand Plaza Hotel',\n      'Sunset Beach Resort',\n      'City Center Inn',\n      'Royal Palace Hotel',\n      'Ocean View Resort',\n      'Mountain Lodge',\n      'Downtown Suites',\n      'Riverside Hotel',\n      'Garden Paradise Resort',\n      'Metropolitan Hotel',\n      'Lakeside Inn',\n      'Heritage Hotel',\n    ];\n\n    const mealTypes = ['Room Only', 'Breakfast Included', 'Half Board', 'Full Board', 'All Inclusive'];\n    const roomTypes = ['Standard Room', 'Deluxe Room', 'Suite', 'Executive Room', 'Family Room'];\n    const amenities = [\n      ['WiFi', 'Pool', 'Gym', 'Restaurant', 'Bar'],\n      ['WiFi', 'Spa', 'Restaurant', 'Room Service'],\n      ['WiFi', 'Parking', 'Business Center', 'Airport Shuttle'],\n      ['WiFi', 'Pool', 'Beach Access', 'Water Sports'],\n      ['WiFi', 'Gym', 'Restaurant', 'Conference Room'],\n    ];\n\n    for (let i = 0; i < hotelCount; i++) {\n      const starRating = 3 + Math.floor(Math.random() * 3); // 3-5 stars\n      const basePrice = 80 + (starRating - 3) * 50 + Math.floor(Math.random() * 100);\n      const tax = Math.floor(basePrice * 0.15);\n      const publishedPrice = basePrice + tax;\n      const discount = Math.floor(Math.random() * 20);\n      const offeredPrice = publishedPrice - discount;\n\n      mockHotels.push({\n        bookingCode: `MOCK-HOTEL-${Date.now()}-${i}`,\n        hotelCode: `HTL${String(i + 1).padStart(4, '0')}`,\n        hotelName: hotelNames[i % hotelNames.length],\n        starRating,\n        address: `${100 + i} Main Street, ${criteria.cityCode || 'City'}`,\n        contactNumber: `+1-555-${String(1000 + i).padStart(4, '0')}`,\n        cityName: criteria.cityCode || 'Mock City',\n        countryName: 'Mock Country',\n        price: {\n          currency: 'USD',\n          roomPrice: basePrice,\n          tax,\n          extraGuestCharge: 0,\n          childCharge: 0,\n          otherCharges: 0,\n          discount,\n          publishedPrice,\n          offeredPrice,\n          agentCommission: 0,\n          agentMarkUp: 0,\n        },\n        refundable: Math.random() > 0.3, // 70% refundable\n        mealType: mealTypes[Math.floor(Math.random() * mealTypes.length)],\n        roomType: roomTypes[Math.floor(Math.random() * roomTypes.length)],\n        availableRooms: 1 + Math.floor(Math.random() * 5),\n        amenities: amenities[Math.floor(Math.random() * amenities.length)],\n        hotelPicture: `https://via.placeholder.com/400x300?text=${encodeURIComponent(hotelNames[i % hotelNames.length])}`,\n        hotelImages: [\n          `https://via.placeholder.com/800x600?text=Image1`,\n          `https://via.placeholder.com/800x600?text=Image2`,\n          `https://via.placeholder.com/800x600?text=Image3`,\n        ],\n      });\n    }\n\n    return mockHotels;\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet hotelSearchServiceInstance: HotelSearchService | null = null;\n\n/**\n * Get the singleton hotel search service instance\n */\nexport function getHotelSearchService(): HotelSearchService {\n  if (!hotelSearchServiceInstance) {\n    hotelSearchServiceInstance = new HotelSearchService();\n  }\n  return hotelSearchServiceInstance;\n}\n\n/**\n * Reset the singleton instance (useful for testing)\n */\nexport function resetHotelSearchService(): void {\n  hotelSearchServiceInstance = null;\n}\n\n// Export default instance\nexport default getHotelSearchService();\n","/**\n * Hotel Search Form Component\n * \n * Provides hotel search functionality with:\n * - Location, check-in/check-out dates, rooms, and guest configuration\n * - Form validation for all inputs\n * - Integration with hotelSearchService\n * - Loading state during search\n * \n * Requirements: 1.1\n */\n\nimport React, { useState } from 'react';\nimport { getHotelSearchService } from '../../services/hotelSearchService';\nimport type { HotelSearchCriteria, PaxRoomInput, HotelSearchResult } from '../../services/hotelSearchService';\nimport './HotelSearchForm.css';\n\ninterface FormErrors {\n  location?: string;\n  checkIn?: string;\n  checkOut?: string;\n  guestNationality?: string;\n  rooms?: string;\n  submit?: string;\n}\n\ninterface RoomConfig {\n  adults: number;\n  children: number;\n  childrenAges: number[];\n}\n\ninterface HotelSearchFormProps {\n  onSearchComplete?: (results: HotelSearchResult) => void;\n  onSearchError?: (error: string) => void;\n}\n\nconst HotelSearchForm: React.FC<HotelSearchFormProps> = ({\n  onSearchComplete,\n  onSearchError,\n}) => {\n  const hotelSearchService = getHotelSearchService();\n  \n  const [isLoading, setIsLoading] = useState(false);\n  const [errors, setErrors] = useState<FormErrors>({});\n  \n  // Form state\n  const [cityCode, setCityCode] = useState('');\n  const [checkIn, setCheckIn] = useState('');\n  const [checkOut, setCheckOut] = useState('');\n  const [guestNationality, setGuestNationality] = useState('US');\n  const [rooms, setRooms] = useState<RoomConfig[]>([\n    { adults: 2, children: 0, childrenAges: [] }\n  ]);\n\n  const validateForm = (): boolean => {\n    const newErrors: FormErrors = {};\n\n    // Validate location\n    if (!cityCode.trim()) {\n      newErrors.location = 'Please enter a city code';\n    }\n\n    // Validate check-in date\n    if (!checkIn) {\n      newErrors.checkIn = 'Please select a check-in date';\n    } else {\n      const checkInDate = new Date(checkIn);\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      if (checkInDate < today) {\n        newErrors.checkIn = 'Check-in date cannot be in the past';\n      }\n    }\n\n    // Validate check-out date\n    if (!checkOut) {\n      newErrors.checkOut = 'Please select a check-out date';\n    } else if (checkIn) {\n      const checkInDate = new Date(checkIn);\n      const checkOutDate = new Date(checkOut);\n      \n      if (checkOutDate <= checkInDate) {\n        newErrors.checkOut = 'Check-out date must be after check-in date';\n      }\n    }\n\n    // Validate guest nationality\n    if (!guestNationality.trim()) {\n      newErrors.guestNationality = 'Please select guest nationality';\n    }\n\n    // Validate rooms\n    if (rooms.length === 0) {\n      newErrors.rooms = 'At least one room is required';\n    } else {\n      for (let i = 0; i < rooms.length; i++) {\n        const room = rooms[i];\n        \n        if (room.adults < 1) {\n          newErrors.rooms = `Room ${i + 1}: At least one adult is required`;\n          break;\n        }\n        \n        if (room.children > 0 && room.childrenAges.length !== room.children) {\n          newErrors.rooms = `Room ${i + 1}: Please provide ages for all children`;\n          break;\n        }\n      }\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n    setErrors({});\n\n    try {\n      // Build search criteria\n      const criteria: HotelSearchCriteria = {\n        checkIn: new Date(checkIn),\n        checkOut: new Date(checkOut),\n        cityCode: cityCode.trim(),\n        guestNationality: guestNationality.trim(),\n        paxRooms: rooms.map(room => ({\n          adults: room.adults,\n          children: room.children,\n          childrenAges: room.childrenAges,\n        })),\n        isDetailedResponse: true,\n      };\n\n      // Call search service\n      const results = await hotelSearchService.search(criteria);\n\n      // Notify parent component\n      if (onSearchComplete) {\n        onSearchComplete(results);\n      }\n\n    } catch (error) {\n      console.error('Hotel search error:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Failed to search hotels. Please try again.';\n      \n      setErrors({ submit: errorMessage });\n      \n      if (onSearchError) {\n        onSearchError(errorMessage);\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleAddRoom = () => {\n    if (rooms.length < 9) {\n      setRooms([...rooms, { adults: 2, children: 0, childrenAges: [] }]);\n    }\n  };\n\n  const handleRemoveRoom = (index: number) => {\n    if (rooms.length > 1) {\n      setRooms(rooms.filter((_, i) => i !== index));\n    }\n  };\n\n  const handleRoomChange = (index: number, field: keyof RoomConfig, value: number) => {\n    const newRooms = [...rooms];\n    \n    if (field === 'adults' || field === 'children') {\n      newRooms[index][field] = value;\n      \n      // Adjust children ages array when children count changes\n      if (field === 'children') {\n        const currentAges = newRooms[index].childrenAges;\n        if (value > currentAges.length) {\n          // Add default ages for new children\n          newRooms[index].childrenAges = [\n            ...currentAges,\n            ...Array(value - currentAges.length).fill(5)\n          ];\n        } else {\n          // Remove excess ages\n          newRooms[index].childrenAges = currentAges.slice(0, value);\n        }\n      }\n    }\n    \n    setRooms(newRooms);\n  };\n\n  const handleChildAgeChange = (roomIndex: number, childIndex: number, age: number) => {\n    const newRooms = [...rooms];\n    newRooms[roomIndex].childrenAges[childIndex] = age;\n    setRooms(newRooms);\n  };\n\n  const handleReset = () => {\n    setCityCode('');\n    setCheckIn('');\n    setCheckOut('');\n    setGuestNationality('US');\n    setRooms([{ adults: 2, children: 0, childrenAges: [] }]);\n    setErrors({});\n  };\n\n  // Get minimum check-out date (day after check-in)\n  const getMinCheckOutDate = (): string => {\n    if (!checkIn) return '';\n    const date = new Date(checkIn);\n    date.setDate(date.getDate() + 1);\n    return date.toISOString().split('T')[0];\n  };\n\n  // Get today's date for min check-in\n  const getTodayDate = (): string => {\n    return new Date().toISOString().split('T')[0];\n  };\n\n  return (\n    <div className=\"hotel-search-form\">\n      <div className=\"form-header\">\n        <h2>Search Hotels</h2>\n        <p>Find the perfect accommodation for your stay</p>\n      </div>\n\n      {errors.submit && (\n        <div className=\"error-message submit-error\">\n          <span className=\"error-icon\"></span>\n          {errors.submit}\n        </div>\n      )}\n\n      <form onSubmit={handleSubmit} className=\"form-container\">\n        {/* Location */}\n        <div className=\"form-group\">\n          <label htmlFor=\"cityCode\">\n            City Code <span className=\"required\">*</span>\n          </label>\n          <input\n            id=\"cityCode\"\n            type=\"text\"\n            value={cityCode}\n            onChange={(e) => setCityCode(e.target.value)}\n            placeholder=\"e.g., NYC, LON, PAR\"\n            className={errors.location ? 'error' : ''}\n            disabled={isLoading}\n          />\n          {errors.location && (\n            <span className=\"error-text\">{errors.location}</span>\n          )}\n        </div>\n\n        {/* Dates */}\n        <div className=\"form-row\">\n          <div className=\"form-group\">\n            <label htmlFor=\"checkIn\">\n              Check-in Date <span className=\"required\">*</span>\n            </label>\n            <input\n              id=\"checkIn\"\n              type=\"date\"\n              value={checkIn}\n              onChange={(e) => setCheckIn(e.target.value)}\n              min={getTodayDate()}\n              className={errors.checkIn ? 'error' : ''}\n              disabled={isLoading}\n            />\n            {errors.checkIn && (\n              <span className=\"error-text\">{errors.checkIn}</span>\n            )}\n          </div>\n\n          <div className=\"form-group\">\n            <label htmlFor=\"checkOut\">\n              Check-out Date <span className=\"required\">*</span>\n            </label>\n            <input\n              id=\"checkOut\"\n              type=\"date\"\n              value={checkOut}\n              onChange={(e) => setCheckOut(e.target.value)}\n              min={getMinCheckOutDate()}\n              className={errors.checkOut ? 'error' : ''}\n              disabled={isLoading}\n            />\n            {errors.checkOut && (\n              <span className=\"error-text\">{errors.checkOut}</span>\n            )}\n          </div>\n        </div>\n\n        {/* Guest Nationality */}\n        <div className=\"form-group\">\n          <label htmlFor=\"guestNationality\">\n            Guest Nationality <span className=\"required\">*</span>\n          </label>\n          <select\n            id=\"guestNationality\"\n            value={guestNationality}\n            onChange={(e) => setGuestNationality(e.target.value)}\n            className={errors.guestNationality ? 'error' : ''}\n            disabled={isLoading}\n          >\n            <option value=\"US\">United States</option>\n            <option value=\"GB\">United Kingdom</option>\n            <option value=\"CA\">Canada</option>\n            <option value=\"AU\">Australia</option>\n            <option value=\"DE\">Germany</option>\n            <option value=\"FR\">France</option>\n            <option value=\"IT\">Italy</option>\n            <option value=\"ES\">Spain</option>\n            <option value=\"IN\">India</option>\n            <option value=\"CN\">China</option>\n            <option value=\"JP\">Japan</option>\n          </select>\n          {errors.guestNationality && (\n            <span className=\"error-text\">{errors.guestNationality}</span>\n          )}\n        </div>\n\n        {/* Rooms Configuration */}\n        <div className=\"rooms-section\">\n          <div className=\"rooms-header\">\n            <h3>Rooms & Guests</h3>\n            {rooms.length < 9 && (\n              <button\n                type=\"button\"\n                onClick={handleAddRoom}\n                className=\"btn-add-room\"\n                disabled={isLoading}\n              >\n                + Add Room\n              </button>\n            )}\n          </div>\n\n          {errors.rooms && (\n            <span className=\"error-text\">{errors.rooms}</span>\n          )}\n\n          {rooms.map((room, roomIndex) => (\n            <div key={roomIndex} className=\"room-config\">\n              <div className=\"room-header\">\n                <h4>Room {roomIndex + 1}</h4>\n                {rooms.length > 1 && (\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveRoom(roomIndex)}\n                    className=\"btn-remove-room\"\n                    disabled={isLoading}\n                  >\n                    Remove\n                  </button>\n                )}\n              </div>\n\n              <div className=\"form-row\">\n                <div className=\"form-group\">\n                  <label htmlFor={`adults-${roomIndex}`}>Adults</label>\n                  <select\n                    id={`adults-${roomIndex}`}\n                    value={room.adults}\n                    onChange={(e) => handleRoomChange(roomIndex, 'adults', parseInt(e.target.value))}\n                    disabled={isLoading}\n                  >\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (\n                      <option key={num} value={num}>{num}</option>\n                    ))}\n                  </select>\n                </div>\n\n                <div className=\"form-group\">\n                  <label htmlFor={`children-${roomIndex}`}>Children</label>\n                  <select\n                    id={`children-${roomIndex}`}\n                    value={room.children}\n                    onChange={(e) => handleRoomChange(roomIndex, 'children', parseInt(e.target.value))}\n                    disabled={isLoading}\n                  >\n                    {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (\n                      <option key={num} value={num}>{num}</option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              {room.children > 0 && (\n                <div className=\"children-ages\">\n                  <label>Children Ages</label>\n                  <div className=\"ages-grid\">\n                    {room.childrenAges.map((age, childIndex) => (\n                      <div key={childIndex} className=\"age-input\">\n                        <label htmlFor={`age-${roomIndex}-${childIndex}`}>\n                          Child {childIndex + 1}\n                        </label>\n                        <select\n                          id={`age-${roomIndex}-${childIndex}`}\n                          value={age}\n                          onChange={(e) => handleChildAgeChange(roomIndex, childIndex, parseInt(e.target.value))}\n                          disabled={isLoading}\n                        >\n                          {Array.from({ length: 18 }, (_, i) => i).map(num => (\n                            <option key={num} value={num}>{num}</option>\n                          ))}\n                        </select>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Form Actions */}\n        <div className=\"form-actions\">\n          <button\n            type=\"button\"\n            onClick={handleReset}\n            className=\"btn secondary\"\n            disabled={isLoading}\n          >\n            Reset\n          </button>\n          <button\n            type=\"submit\"\n            className=\"btn primary\"\n            disabled={isLoading}\n          >\n            {isLoading ? (\n              <>\n                <span className=\"loading-spinner\"></span>\n                Searching...\n              </>\n            ) : (\n              <>\n                <span></span>\n                Search Hotels\n              </>\n            )}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default HotelSearchForm;\n","/**\n * Hotel Search Results Component\n * \n * Displays hotel search results with:\n * - Hotel cards in grid layout\n * - Filter controls (refundable, star rating, meal type)\n * - Hotel details (name, location, price, amenities)\n * - Empty results and mock mode indication\n * \n * Requirements: 1.3, 1.4, 8.3\n */\n\nimport React, { useState, useMemo } from 'react';\nimport { getHotelSearchService } from '../../services/hotelSearchService';\nimport type { HotelResult, HotelSearchResult } from '../../services/hotelSearchService';\nimport type { HotelSearchFilters } from '../../types/tboHotelApi';\nimport './HotelSearchResults.css';\n\ninterface HotelSearchResultsProps {\n  searchResult: HotelSearchResult;\n  onHotelSelect?: (hotel: HotelResult) => void;\n}\n\nconst HotelSearchResults: React.FC<HotelSearchResultsProps> = ({\n  searchResult,\n  onHotelSelect,\n}) => {\n  const hotelSearchService = getHotelSearchService();\n  \n  // Filter state\n  const [filters, setFilters] = useState<HotelSearchFilters>({});\n  const [sortBy, setSortBy] = useState<'price' | 'rating' | 'name'>('price');\n\n  // Apply filters and sorting\n  const filteredAndSortedHotels = useMemo(() => {\n    // Apply filters\n    let filtered = hotelSearchService.filterResults(searchResult.hotels, filters);\n\n    // Apply sorting\n    filtered = [...filtered].sort((a, b) => {\n      switch (sortBy) {\n        case 'price':\n          return a.price.offeredPrice - b.price.offeredPrice;\n        case 'rating':\n          return b.starRating - a.starRating;\n        case 'name':\n          return a.hotelName.localeCompare(b.hotelName);\n        default:\n          return 0;\n      }\n    });\n\n    return filtered;\n  }, [searchResult.hotels, filters, sortBy, hotelSearchService]);\n\n  const handleFilterChange = (filterKey: keyof HotelSearchFilters, value: any) => {\n    setFilters(prev => ({\n      ...prev,\n      [filterKey]: value === '' || value === undefined ? undefined : value,\n    }));\n  };\n\n  const handleClearFilters = () => {\n    setFilters({});\n  };\n\n  const hasActiveFilters = Object.keys(filters).some(\n    key => filters[key as keyof HotelSearchFilters] !== undefined\n  );\n\n  return (\n    <div className=\"hotel-search-results\">\n      {/* Mock Mode Indicator */}\n      {searchResult.isMockData && (\n        <div className=\"mock-mode-banner\">\n          <span className=\"mock-icon\"></span>\n          <div className=\"mock-text\">\n            <strong>Demo Mode:</strong> Showing sample hotel data. Real API is unavailable.\n          </div>\n        </div>\n      )}\n\n      {/* Results Header */}\n      <div className=\"results-header\">\n        <h2>\n          {filteredAndSortedHotels.length} {filteredAndSortedHotels.length === 1 ? 'Hotel' : 'Hotels'} Found\n        </h2>\n        <p className=\"search-summary\">\n          {searchResult.searchCriteria.cityCode && `in ${searchResult.searchCriteria.cityCode}`}\n        </p>\n      </div>\n\n      {/* Filters and Sort */}\n      <div className=\"filters-section\">\n        <div className=\"filters-row\">\n          {/* Star Rating Filter */}\n          <div className=\"filter-group\">\n            <label htmlFor=\"starRating\">Star Rating</label>\n            <select\n              id=\"starRating\"\n              value={filters.StarRating || ''}\n              onChange={(e) => handleFilterChange('StarRating', e.target.value ? parseInt(e.target.value) : undefined)}\n            >\n              <option value=\"\">All Ratings</option>\n              <option value=\"5\">5 Stars</option>\n              <option value=\"4\">4 Stars</option>\n              <option value=\"3\">3 Stars</option>\n            </select>\n          </div>\n\n          {/* Refundable Filter */}\n          <div className=\"filter-group\">\n            <label htmlFor=\"refundable\">Cancellation</label>\n            <select\n              id=\"refundable\"\n              value={filters.Refundable === undefined ? '' : filters.Refundable ? 'true' : 'false'}\n              onChange={(e) => handleFilterChange('Refundable', e.target.value === '' ? undefined : e.target.value === 'true')}\n            >\n              <option value=\"\">All Hotels</option>\n              <option value=\"true\">Refundable Only</option>\n              <option value=\"false\">Non-Refundable</option>\n            </select>\n          </div>\n\n          {/* Meal Type Filter */}\n          <div className=\"filter-group\">\n            <label htmlFor=\"mealType\">Meal Plan</label>\n            <select\n              id=\"mealType\"\n              value={filters.MealType || ''}\n              onChange={(e) => handleFilterChange('MealType', e.target.value ? parseInt(e.target.value) : undefined)}\n            >\n              <option value=\"\">All Meal Plans</option>\n              <option value=\"1\">Room Only</option>\n              <option value=\"2\">Breakfast Included</option>\n              <option value=\"3\">Half Board</option>\n              <option value=\"4\">Full Board</option>\n              <option value=\"5\">All Inclusive</option>\n            </select>\n          </div>\n\n          {/* Sort By */}\n          <div className=\"filter-group\">\n            <label htmlFor=\"sortBy\">Sort By</label>\n            <select\n              id=\"sortBy\"\n              value={sortBy}\n              onChange={(e) => setSortBy(e.target.value as 'price' | 'rating' | 'name')}\n            >\n              <option value=\"price\">Price (Low to High)</option>\n              <option value=\"rating\">Star Rating (High to Low)</option>\n              <option value=\"name\">Name (A-Z)</option>\n            </select>\n          </div>\n        </div>\n\n        {hasActiveFilters && (\n          <button onClick={handleClearFilters} className=\"btn-clear-filters\">\n            Clear All Filters\n          </button>\n        )}\n      </div>\n\n      {/* Results Grid */}\n      {filteredAndSortedHotels.length > 0 ? (\n        <div className=\"hotels-grid\">\n          {filteredAndSortedHotels.map((hotel) => (\n            <HotelCard\n              key={hotel.bookingCode}\n              hotel={hotel}\n              onSelect={() => onHotelSelect?.(hotel)}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"no-results\">\n          <div className=\"no-results-icon\"></div>\n          <h3>No Hotels Found</h3>\n          <p>Try adjusting your filters or search criteria</p>\n          {hasActiveFilters && (\n            <button onClick={handleClearFilters} className=\"btn primary\">\n              Clear Filters\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Hotel Card Component\ninterface HotelCardProps {\n  hotel: HotelResult;\n  onSelect: () => void;\n}\n\nconst HotelCard: React.FC<HotelCardProps> = ({ hotel, onSelect }) => {\n  return (\n    <div className=\"hotel-card\">\n      {/* Hotel Image */}\n      <div className=\"hotel-image\">\n        <img src={hotel.hotelPicture} alt={hotel.hotelName} />\n        {hotel.refundable && (\n          <span className=\"refundable-badge\">Free Cancellation</span>\n        )}\n      </div>\n\n      {/* Hotel Info */}\n      <div className=\"hotel-info\">\n        <div className=\"hotel-header\">\n          <h3 className=\"hotel-name\">{hotel.hotelName}</h3>\n          <div className=\"star-rating\">\n            {Array.from({ length: hotel.starRating }, (_, i) => (\n              <span key={i} className=\"star\"></span>\n            ))}\n          </div>\n        </div>\n\n        <p className=\"hotel-location\">\n           {hotel.address}, {hotel.cityName}\n        </p>\n\n        <div className=\"hotel-details\">\n          <span className=\"room-type\">{hotel.roomType}</span>\n          <span className=\"meal-type\"> {hotel.mealType}</span>\n        </div>\n\n        {/* Amenities */}\n        {hotel.amenities.length > 0 && (\n          <div className=\"amenities\">\n            {hotel.amenities.slice(0, 4).map((amenity, index) => (\n              <span key={index} className=\"amenity-tag\">\n                {amenity}\n              </span>\n            ))}\n            {hotel.amenities.length > 4 && (\n              <span className=\"amenity-tag more\">\n                +{hotel.amenities.length - 4} more\n              </span>\n            )}\n          </div>\n        )}\n\n        {/* Pricing */}\n        <div className=\"hotel-pricing\">\n          <div className=\"price-info\">\n            {hotel.price.discount > 0 && (\n              <span className=\"original-price\">\n                {hotel.price.currency} {hotel.price.publishedPrice.toFixed(2)}\n              </span>\n            )}\n            <div className=\"current-price\">\n              <span className=\"currency\">{hotel.price.currency}</span>\n              <span className=\"amount\">{hotel.price.offeredPrice.toFixed(2)}</span>\n            </div>\n            <span className=\"price-label\">per night</span>\n          </div>\n\n          <button onClick={onSelect} className=\"btn-select\">\n            View Details\n          </button>\n        </div>\n\n        {/* Available Rooms */}\n        {hotel.availableRooms <= 3 && (\n          <div className=\"availability-warning\">\n            Only {hotel.availableRooms} room{hotel.availableRooms !== 1 ? 's' : ''} left!\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default HotelSearchResults;\n","/**\n * Hotel Booking Service\n * \n * Manages the sequential hotel booking workflow and session state.\n * Maintains BookingCode consistency across all booking steps and handles session lifecycle.\n * \n * Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6\n */\n\nimport type { \n  Hotel, \n  PreBookResponse, \n  HotelBookingResponse,\n  HotelBookingRequest,\n  GuestDetail as ApiGuestDetail,\n  CustomerName as ApiCustomerName\n} from '../types/tboHotelApi';\nimport { getTboHotelApiClient } from './api/tboHotelApiClient';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type HotelBookingStatus = \n  | 'search' \n  | 'details' \n  | 'prebook' \n  | 'guest_details' \n  | 'payment' \n  | 'confirmed';\n\nexport interface HotelBookingSession {\n  sessionId: string;\n  hotel: Hotel;\n  searchCriteria: HotelSearchCriteria;\n  bookingCode: string;\n  preBookResult?: PreBookResult;\n  status: HotelBookingStatus;\n  createdAt: Date;\n  expiresAt: Date;\n}\n\nexport interface HotelSearchCriteria {\n  checkIn: Date;\n  checkOut: Date;\n  hotelCodes?: string;\n  cityCode?: string;\n  guestNationality: string;\n  paxRooms: PaxRoom[];\n}\n\nexport interface PaxRoom {\n  adults: number;\n  children: number;\n  childrenAges: number[];\n}\n\nexport interface PreBookResult {\n  bookingCode: string;\n  originalPrice: number;\n  currentPrice: number;\n  priceChanged: boolean;\n  available: boolean;\n}\n\nexport interface GuestDetails {\n  roomIndex: number;\n  customerNames: CustomerName[];\n}\n\nexport interface CustomerName {\n  title: string;\n  firstName: string;\n  lastName: string;\n  type: 'Adult' | 'Child';\n}\n\nexport interface PaymentInfo {\n  method: 'credit_card' | 'debit_card' | 'upi' | 'net_banking';\n  emailId?: string;\n  phoneNumber?: string;\n  // Additional payment fields would be added here\n}\n\nexport interface HotelBookingConfirmation {\n  confirmationNumber: string;\n  bookingReferenceId: string;\n  hotel: Hotel;\n  guestDetails: GuestDetails[];\n  totalFare: number;\n  currency: string;\n  checkIn: Date;\n  checkOut: Date;\n  bookedAt: Date;\n  status: string;\n  voucherUrl?: string;\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst SESSION_TIMEOUT_MINUTES = 30;\nconst SESSION_STORAGE_KEY = 'hotel_booking_session';\n\n// ============================================================================\n// Service Implementation\n// ============================================================================\n\nclass HotelBookingService {\n  private currentSession: HotelBookingSession | null = null;\n  private timeoutId: NodeJS.Timeout | null = null;\n\n  /**\n   * Initialize a new hotel booking session\n   * \n   * @param hotel - The selected hotel to book\n   * @param searchCriteria - The search criteria used to find the hotel\n   * @returns The initialized booking session\n   * \n   * Requirements: 7.1, 7.4\n   */\n  startBooking(hotel: Hotel, searchCriteria: HotelSearchCriteria): HotelBookingSession {\n    // Cancel any existing session\n    this.cancelSession();\n\n    const now = new Date();\n    const expiresAt = new Date(now.getTime() + SESSION_TIMEOUT_MINUTES * 60 * 1000);\n\n    const session: HotelBookingSession = {\n      sessionId: this.generateSessionId(),\n      hotel,\n      searchCriteria,\n      bookingCode: hotel.BookingCode,\n      status: 'details',\n      createdAt: now,\n      expiresAt,\n    };\n\n    this.currentSession = session;\n    this.persistSession(session);\n    this.scheduleSessionTimeout();\n\n    return session;\n  }\n\n  /**\n   * Get the current active booking session\n   * \n   * @returns The current session or null if no active session\n   * \n   * Requirements: 7.2\n   */\n  getCurrentSession(): HotelBookingSession | null {\n    // Check if session has expired\n    if (this.currentSession && new Date() > this.currentSession.expiresAt) {\n      this.cancelSession();\n      return null;\n    }\n\n    return this.currentSession;\n  }\n\n  /**\n   * Update the current session with new data\n   * \n   * @param stepData - Partial session data to update\n   * \n   * Requirements: 7.2, 7.4\n   */\n  updateSession(stepData: Partial<HotelBookingSession>): void {\n    if (!this.currentSession) {\n      throw new Error('No active hotel booking session');\n    }\n\n    // Check if session has expired\n    if (new Date() > this.currentSession.expiresAt) {\n      this.cancelSession();\n      throw new Error('Hotel booking session has expired');\n    }\n\n    // Update session with new data\n    this.currentSession = {\n      ...this.currentSession,\n      ...stepData,\n    };\n\n    this.persistSession(this.currentSession);\n  }\n\n  /**\n   * Cancel the current booking session and clean up resources\n   * \n   * Requirements: 7.3\n   */\n  cancelSession(): void {\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = null;\n    }\n\n    this.currentSession = null;\n    this.clearPersistedSession();\n  }\n\n  /**\n   * Complete the hotel booking with guest details and payment information\n   * \n   * @param guestDetails - Guest information for each room\n   * @param paymentInfo - Payment information\n   * @returns Hotel booking confirmation\n   * \n   * Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6\n   */\n  async completeBooking(\n    guestDetails: GuestDetails[], \n    paymentInfo: PaymentInfo\n  ): Promise<HotelBookingConfirmation> {\n    const session = this.getCurrentSession();\n    \n    if (!session) {\n      throw new Error('No active hotel booking session');\n    }\n\n    if (!session.preBookResult) {\n      throw new Error('Pre-booking validation required before completing booking');\n    }\n\n    // Use the BookingCode from pre-book result (most recent)\n    const bookingCode = session.preBookResult.bookingCode;\n\n    // Transform guest details to API format\n    const apiGuestDetails = this.transformGuestDetailsToApiFormat(guestDetails);\n\n    // Generate unique reference IDs\n    const clientReferenceId = this.generateClientReferenceId();\n    const bookingReferenceId = this.generateBookingReferenceId();\n\n    // Build the booking request\n    const bookingRequest: HotelBookingRequest = {\n      BookingCode: bookingCode,\n      CustomerDetails: apiGuestDetails,\n      ClientReferenceId: clientReferenceId,\n      BookingReferenceId: bookingReferenceId,\n      TotalFare: session.preBookResult.currentPrice,\n      EmailId: paymentInfo.emailId || '',\n      PhoneNumber: paymentInfo.phoneNumber || '',\n      BookingType: 'API',\n      PaymentMode: this.mapPaymentMethodToApiFormat(paymentInfo.method),\n    };\n\n    try {\n      // Call the booking API\n      const apiClient = getTboHotelApiClient();\n      const response = await apiClient.createBooking(bookingRequest);\n\n      // Generate booking confirmation from API response\n      const confirmation = this.generateBookingConfirmation(\n        response,\n        session,\n        guestDetails\n      );\n\n      // Update session status to confirmed\n      this.updateSession({\n        status: 'confirmed',\n      });\n\n      // Integrate with TravelSphere itinerary system\n      await this.integrateWithItinerary(confirmation);\n\n      return confirmation;\n    } catch (error) {\n      // Preserve session for retry on failure (Requirement 4.4)\n      console.error('Hotel booking failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Transform guest details from internal format to API format\n   * \n   * Requirements: 4.1\n   */\n  private transformGuestDetailsToApiFormat(guestDetails: GuestDetails[]): ApiGuestDetail[] {\n    return guestDetails.map(room => ({\n      CustomerNames: room.customerNames.map(customer => ({\n        Title: customer.title,\n        FirstName: customer.firstName,\n        LastName: customer.lastName,\n        Type: customer.type,\n      })),\n    }));\n  }\n\n  /**\n   * Generate booking confirmation from API response\n   * \n   * Requirements: 4.2, 4.6\n   */\n  private generateBookingConfirmation(\n    response: HotelBookingResponse,\n    session: HotelBookingSession,\n    guestDetails: GuestDetails[]\n  ): HotelBookingConfirmation {\n    return {\n      confirmationNumber: response.ConfirmationNo,\n      bookingReferenceId: response.BookingRefNo,\n      hotel: session.hotel,\n      guestDetails,\n      totalFare: response.HotelDetails.TotalFare,\n      currency: response.HotelDetails.CurrencyCode,\n      checkIn: session.searchCriteria.checkIn,\n      checkOut: session.searchCriteria.checkOut,\n      bookedAt: new Date(),\n      status: 'Confirmed',\n      voucherUrl: response.VoucherUrl,\n    };\n  }\n\n  /**\n   * Integrate hotel booking with TravelSphere itinerary system\n   * \n   * Requirements: 4.5\n   */\n  private async integrateWithItinerary(confirmation: HotelBookingConfirmation): Promise<void> {\n    try {\n      // Import itinerary service dynamically to avoid circular dependencies\n      const { itineraryService } = await import('./itineraryService');\n      \n      // Transform confirmation to HotelBooking format for itinerary\n      const hotelBooking = {\n        confirmationNumber: confirmation.confirmationNumber,\n        bookingReferenceId: confirmation.bookingReferenceId,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        hotelName: confirmation.hotel.hotelName,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        address: confirmation.hotel.address,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        cityName: confirmation.hotel.cityName,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        countryName: confirmation.hotel.countryName,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        starRating: confirmation.hotel.starRating,\n        checkIn: confirmation.checkIn,\n        checkOut: confirmation.checkOut,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        roomType: confirmation.hotel.roomType,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        mealType: confirmation.hotel.mealType,\n        guests: confirmation.guestDetails.flatMap(room => \n          room.customerNames.map(guest => `${guest.title} ${guest.firstName} ${guest.lastName}`)\n        ),\n        totalFare: confirmation.totalFare,\n        currency: confirmation.currency,\n        status: confirmation.status,\n        bookedAt: confirmation.bookedAt,\n        // @ts-expect-error - API uses PascalCase, code uses camelCase\n        refundable: confirmation.hotel.refundable,\n      };\n      \n      // Add to itinerary service\n      itineraryService.addHotelBooking(hotelBooking);\n      \n      // Also store in separate hotel bookings storage for backward compatibility\n      const existingBookings = this.getStoredHotelBookings();\n      existingBookings.push(confirmation);\n      localStorage.setItem('hotel_bookings', JSON.stringify(existingBookings));\n      \n      console.log('Hotel booking integrated with itinerary:', confirmation.confirmationNumber);\n    } catch (error) {\n      console.error('Failed to integrate hotel booking with itinerary:', error);\n      // Don't throw - booking is still successful even if itinerary integration fails\n    }\n  }\n\n  /**\n   * Get stored hotel bookings from local storage\n   */\n  private getStoredHotelBookings(): HotelBookingConfirmation[] {\n    try {\n      const stored = localStorage.getItem('hotel_bookings');\n      return stored ? JSON.parse(stored) : [];\n    } catch (error) {\n      console.error('Failed to retrieve stored hotel bookings:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Map payment method to API format\n   */\n  private mapPaymentMethodToApiFormat(method: string): string {\n    // TBO API uses 'Limit' for credit limit payment mode\n    // Map internal payment methods to API format\n    const paymentModeMap: Record<string, string> = {\n      'credit_card': 'Limit',\n      'debit_card': 'Limit',\n      'upi': 'Limit',\n      'net_banking': 'Limit',\n    };\n    \n    return paymentModeMap[method] || 'Limit';\n  }\n\n  /**\n   * Generate unique client reference ID\n   */\n  private generateClientReferenceId(): string {\n    return `TS_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  /**\n   * Generate unique booking reference ID\n   */\n  private generateBookingReferenceId(): string {\n    return `BOOK_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  /**\n   * Restore a session from storage (e.g., after page refresh)\n   * \n   * @returns The restored session or null if no valid session exists\n   * \n   * Requirements: 7.5\n   */\n  restoreSession(): HotelBookingSession | null {\n    try {\n      const stored = localStorage.getItem(SESSION_STORAGE_KEY);\n      if (!stored) {\n        return null;\n      }\n\n      const session: HotelBookingSession = JSON.parse(stored);\n      \n      // Convert date strings back to Date objects\n      session.createdAt = new Date(session.createdAt);\n      session.expiresAt = new Date(session.expiresAt);\n      session.searchCriteria.checkIn = new Date(session.searchCriteria.checkIn);\n      session.searchCriteria.checkOut = new Date(session.searchCriteria.checkOut);\n\n      // Check if session has expired\n      if (new Date() > session.expiresAt) {\n        this.clearPersistedSession();\n        return null;\n      }\n\n      this.currentSession = session;\n      this.scheduleSessionTimeout();\n\n      return session;\n    } catch (error) {\n      console.error('Failed to restore hotel booking session:', error);\n      this.clearPersistedSession();\n      return null;\n    }\n  }\n\n  // ============================================================================\n  // Private Helper Methods\n  // ============================================================================\n\n  /**\n   * Generate a unique session ID\n   */\n  private generateSessionId(): string {\n    return `hotel_session_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n  }\n\n  /**\n   * Persist the session to localStorage\n   */\n  private persistSession(session: HotelBookingSession): void {\n    try {\n      localStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(session));\n    } catch (error) {\n      console.error('Failed to persist hotel booking session:', error);\n    }\n  }\n\n  /**\n   * Clear the persisted session from localStorage\n   */\n  private clearPersistedSession(): void {\n    try {\n      localStorage.removeItem(SESSION_STORAGE_KEY);\n    } catch (error) {\n      console.error('Failed to clear persisted hotel booking session:', error);\n    }\n  }\n\n  /**\n   * Schedule automatic session timeout\n   * \n   * Requirements: 7.3\n   */\n  private scheduleSessionTimeout(): void {\n    if (this.timeoutId) {\n      clearTimeout(this.timeoutId);\n    }\n\n    if (!this.currentSession) {\n      return;\n    }\n\n    const timeUntilExpiry = this.currentSession.expiresAt.getTime() - Date.now();\n\n    if (timeUntilExpiry > 0) {\n      this.timeoutId = setTimeout(() => {\n        console.log('Hotel booking session expired');\n        this.cancelSession();\n      }, timeUntilExpiry);\n    }\n  }\n}\n\n// ============================================================================\n// Export Singleton Instance\n// ============================================================================\n\nexport const hotelBookingService = new HotelBookingService();\nexport default hotelBookingService;\n","/**\n * Hotel Booking Workflow Component\n * \n * Multi-step workflow container for hotel booking process.\n * Manages step navigation, progress indication, and validation.\n * \n * Workflow: Search  Details  PreBook  Guest Details  Payment  Confirmation\n * \n * Requirements: All workflow requirements\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { hotelBookingService, HotelBookingSession } from '../../services/hotelBookingService';\nimport './HotelBookingWorkflow.css';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type WorkflowStep = 'details' | 'prebook' | 'guest_details' | 'payment' | 'confirmed';\n\ninterface HotelBookingWorkflowProps {\n  session: HotelBookingSession;\n  onComplete?: (confirmationNumber: string) => void;\n  onCancel?: () => void;\n}\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport const HotelBookingWorkflow: React.FC<HotelBookingWorkflowProps> = ({\n  session: initialSession,\n  onComplete,\n  onCancel,\n}) => {\n  const [currentStep, setCurrentStep] = useState<WorkflowStep>(() => {\n    // Initialize from session status, ensuring it's a valid WorkflowStep\n    const status = initialSession.status;\n    if (status === 'search') return 'details';\n    return status as WorkflowStep;\n  });\n  const [session, setSession] = useState<HotelBookingSession>(initialSession);\n\n  // Restore session on mount\n  useEffect(() => {\n    const restoredSession = hotelBookingService.getCurrentSession();\n    if (restoredSession) {\n      setSession(restoredSession);\n      const status = restoredSession.status;\n      if (status === 'search') {\n        setCurrentStep('details');\n      } else {\n        setCurrentStep(status as WorkflowStep);\n      }\n    }\n  }, []);\n\n  // Update session when step changes\n  useEffect(() => {\n    try {\n      hotelBookingService.updateSession({ status: currentStep });\n    } catch (error) {\n      // Session might not exist or be expired\n      console.error('Failed to update session:', error);\n    }\n  }, [currentStep]);\n\n  const steps: { key: WorkflowStep; label: string }[] = [\n    { key: 'details', label: 'Hotel Details' },\n    { key: 'prebook', label: 'Verify Pricing' },\n    { key: 'guest_details', label: 'Guest Details' },\n    { key: 'payment', label: 'Payment' },\n    { key: 'confirmed', label: 'Confirmation' },\n  ];\n\n  const currentStepIndex = steps.findIndex(s => s.key === currentStep);\n\n  const handleNext = () => {\n    const nextIndex = currentStepIndex + 1;\n    if (nextIndex < steps.length) {\n      setCurrentStep(steps[nextIndex].key);\n    }\n  };\n\n  const handleBack = () => {\n    const prevIndex = currentStepIndex - 1;\n    if (prevIndex >= 0) {\n      setCurrentStep(steps[prevIndex].key);\n    }\n  };\n\n  const handleCancel = () => {\n    hotelBookingService.cancelSession();\n    onCancel?.();\n  };\n\n  const handleStepComplete = (stepData?: any) => {\n    if (stepData) {\n      hotelBookingService.updateSession(stepData);\n      const updatedSession = hotelBookingService.getCurrentSession();\n      if (updatedSession) {\n        setSession(updatedSession);\n      }\n    }\n    handleNext();\n  };\n\n  return (\n    <div className=\"hotel-booking-workflow\">\n      {/* Progress Indicator */}\n      <div className=\"workflow-progress\">\n        <div className=\"progress-steps\">\n          {steps.map((step, index) => (\n            <div\n              key={step.key}\n              className={`progress-step ${\n                index < currentStepIndex\n                  ? 'completed'\n                  : index === currentStepIndex\n                  ? 'active'\n                  : 'pending'\n              }`}\n            >\n              <div className=\"step-indicator\">\n                {index < currentStepIndex ? (\n                  <span className=\"step-check\"></span>\n                ) : (\n                  <span className=\"step-number\">{index + 1}</span>\n                )}\n              </div>\n              <div className=\"step-label\">{step.label}</div>\n              {index < steps.length - 1 && <div className=\"step-connector\" />}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Step Content */}\n      <div className=\"workflow-content\">\n        {/* Placeholder for step components - will be replaced with actual components */}\n        <div className=\"step-placeholder\">\n          <h3>Step: {steps[currentStepIndex].label}</h3>\n          <p>Current step: {currentStep}</p>\n          <p>Hotel: {session.hotel.HotelName}</p>\n          <p>Check-in: {session.searchCriteria.checkIn.toLocaleDateString()}</p>\n          <p>Check-out: {session.searchCriteria.checkOut.toLocaleDateString()}</p>\n        </div>\n      </div>\n\n      {/* Navigation Buttons */}\n      <div className=\"workflow-actions\">\n        <button\n          type=\"button\"\n          onClick={handleCancel}\n          className=\"btn-cancel\"\n        >\n          Cancel Booking\n        </button>\n        \n        <div className=\"workflow-nav-buttons\">\n          {currentStepIndex > 0 && currentStep !== 'confirmed' && (\n            <button\n              type=\"button\"\n              onClick={handleBack}\n              className=\"btn-back\"\n            >\n              Back\n            </button>\n          )}\n          \n          {currentStep !== 'confirmed' && (\n            <button\n              type=\"button\"\n              onClick={handleNext}\n              className=\"btn-next\"\n            >\n              {currentStepIndex === steps.length - 2 ? 'Complete Booking' : 'Continue'}\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default HotelBookingWorkflow;\n","import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { HotelBookingWorkflow, HotelSearchForm, HotelSearchResults } from '../components/hotel';\nimport { hotelBookingService, HotelBookingSession } from '../services/hotelBookingService';\nimport type { HotelSearchResult, HotelResult } from '../services/hotelSearchService';\nimport './HotelBookingPage.css';\n\nconst HotelBookingPage: React.FC = () => {\n  const navigate = useNavigate();\n  const [session, setSession] = useState<HotelBookingSession | null>(null);\n  const [searchResults, setSearchResults] = useState<HotelSearchResult | null>(null);\n\n  useEffect(() => {\n    // Check if there's an active booking session\n    const activeSession = hotelBookingService.getCurrentSession();\n    if (activeSession) {\n      setSession(activeSession);\n    }\n  }, []);\n\n  const handleSearchComplete = (results: HotelSearchResult) => {\n    setSearchResults(results);\n  };\n\n  const handleHotelSelect = (hotel: HotelResult) => {\n    if (searchResults) {\n      // Start a booking session with the selected hotel\n      const newSession = hotelBookingService.startBooking(\n        hotel as any, // Type conversion needed - HotelResult vs Hotel type mismatch\n        searchResults.searchCriteria\n      );\n      setSession(newSession);\n      setSearchResults(null);\n    }\n  };\n\n  const handleBookingComplete = (confirmationNumber: string) => {\n    // Navigate to itinerary page with the booking confirmation\n    navigate(`/itinerary?booking=${confirmationNumber}`);\n  };\n\n  const handleCancel = () => {\n    hotelBookingService.cancelSession();\n    setSession(null);\n  };\n\n  const handleBackToSearch = () => {\n    setSearchResults(null);\n  };\n\n  return (\n    <div className=\"hotel-booking-page\">\n      <div className=\"page-header\">\n        <h1>Book Hotels</h1>\n        <p>Find and book the perfect accommodation for your trip</p>\n      </div>\n      \n      {session ? (\n        <HotelBookingWorkflow \n          session={session}\n          onComplete={handleBookingComplete}\n          onCancel={handleCancel}\n        />\n      ) : searchResults ? (\n        <div>\n          <button \n            className=\"back-button\"\n            onClick={handleBackToSearch}\n            style={{ marginBottom: '1rem' }}\n          >\n             Back to Search\n          </button>\n          <HotelSearchResults \n            searchResult={searchResults}\n            onHotelSelect={handleHotelSelect}\n          />\n        </div>\n      ) : (\n        <HotelSearchForm onSearchComplete={handleSearchComplete} />\n      )}\n    </div>\n  );\n};\n\nexport default HotelBookingPage;\n"],"file":"HotelBookingPage-eRJZqlfB.js"}